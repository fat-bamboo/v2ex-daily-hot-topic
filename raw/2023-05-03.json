[{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1677911181","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1677911181","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":55503,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1677911181","stars":8359,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"id":577140,"username":"233666666","url":"https://www.v2ex.com/u/233666666","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/27eaad2cfb06f4991bb5e05fb7adf8e1?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/27eaad2cfb06f4991bb5e05fb7adf8e1?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/27eaad2cfb06f4991bb5e05fb7adf8e1?s=73&d=retro","created":1648740293,"last_modified":1648740293},"last_reply_by":"x86","last_touched":1683091053,"title":"今天又是张小龙被灭族的一天","url":"https://www.v2ex.com/t/936964","created":1683080939,"deleted":0,"content":"想注销微信，注销是有条件的\r\n\r\n银行卡、公众号等等都成功注销了，唯独微信开放平台注册了就没法注销！！！想取消管理员身份就要求更换别人身份证以及已实名注册的微信才能更换！卧槽，我就想注销就注销不了，联系该网站的客户转人工，连续打了十几次转人工依旧是机器应答，我故意说我要跳楼，依旧是机器应答，转不了人工\r\n\r\n今天又是张小龙的家族被灭族的一天","content_rendered":"<p>想注销微信，注销是有条件的</p>\n<p>银行卡、公众号等等都成功注销了，唯独微信开放平台注册了就没法注销！！！想取消管理员身份就要求更换别人身份证以及已实名注册的微信才能更换！卧槽，我就想注销就注销不了，联系该网站的客户转人工，连续打了十几次转人工依旧是机器应答，我故意说我要跳楼，依旧是机器应答，转不了人工</p>\n<p>今天又是张小龙的家族被灭族的一天</p>\n","last_modified":1683080939,"replies":36,"id":936964},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/a3c6/5c29/108_large.png?m=1680100332","name":"bb","avatar_normal":"https://cdn.v2ex.com/navatar/a3c6/5c29/108_normal.png?m=1680100332","title":"宽带症候群","url":"https://www.v2ex.com/go/bb","topics":12717,"footer":"","header":"网速很重要。比快更快。","title_alternative":"Broadband Symptom Complex","avatar_mini":"https://cdn.v2ex.com/navatar/a3c6/5c29/108_mini.png?m=1680100332","stars":6410,"aliases":[],"root":false,"id":108,"parent_node_name":"geek"},"member":{"id":601039,"username":"springwood","url":"https://www.v2ex.com/u/springwood","website":"https://springwood.me","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"沉舟侧畔 Blog https://springwood.me","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/448e/7ef5/601039_mini.png?m=1682157314","avatar_normal":"https://cdn.v2ex.com/avatar/448e/7ef5/601039_normal.png?m=1682157314","avatar_large":"https://cdn.v2ex.com/avatar/448e/7ef5/601039_large.png?m=1682157314","avatar_xlarge":"https://cdn.v2ex.com/avatar/448e/7ef5/601039_xlarge.png?m=1682157314","avatar_xxlarge":"https://cdn.v2ex.com/avatar/448e/7ef5/601039_xlarge.png?m=1682157314","avatar_xxxlarge":"https://cdn.v2ex.com/avatar/448e/7ef5/601039_xlarge.png?m=1682157314","created":1667879429,"last_modified":1682157314},"last_reply_by":"jsq2627","last_touched":1683089631,"title":"为什么很多人看重宽带的上行速度？","url":"https://www.v2ex.com/t/936960","created":1683078813,"deleted":0,"content":"好像[国外的家庭网络宽带]( https://springwood.me/japan-family-network/)普遍上行速度比较高，不会出现上下行不对等的情况。\r\n\r\n不过上行速度快有什么优点？请指点一下。我目前没感觉出优点来，或者说还没有发现优点……","content_rendered":"<p>好像<a href=\"https://springwood.me/japan-family-network/\" rel=\"nofollow\">国外的家庭网络宽带</a>普遍上行速度比较高，不会出现上下行不对等的情况。</p>\n<p>不过上行速度快有什么优点？请指点一下。我目前没感觉出优点来，或者说还没有发现优点……</p>\n","last_modified":1683078813,"replies":24,"id":936960},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":202418,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340","stars":3789,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":611410,"username":"hxlgg01","url":"https://www.v2ex.com/u/hxlgg01","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/5cbcd52c280e4daf74f106055338d6e3?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/5cbcd52c280e4daf74f106055338d6e3?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/5cbcd52c280e4daf74f106055338d6e3?s=73&d=retro","created":1674895264,"last_modified":1679545106},"last_reply_by":"neptuno","last_touched":1683092328,"title":"just my socks 怎么样","url":"https://www.v2ex.com/t/936967","created":1683081425,"deleted":0,"content":"想买 just my socks ，请问速度怎么样？线路质量怎么样？值不值得买？","content_rendered":"<p>想买 just my socks ，请问速度怎么样？线路质量怎么样？值不值得买？</p>\n","last_modified":1683081425,"replies":18,"id":936967},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/069d/3bb0/580_large.png?m=1647952441","name":"ios","avatar_normal":"https://cdn.v2ex.com/navatar/069d/3bb0/580_normal.png?m=1647952441","title":"iOS","url":"https://www.v2ex.com/go/ios","topics":3396,"footer":"","header":"运行于 Apple 移动设备上的操作系统。","title_alternative":"iOS","avatar_mini":"https://cdn.v2ex.com/navatar/069d/3bb0/580_mini.png?m=1647952441","stars":912,"aliases":[],"root":false,"id":580,"parent_node_name":"apple"},"member":{"id":618407,"username":"yfwo","url":"https://www.v2ex.com/u/yfwo","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/1e65/cc16/618407_mini.png?m=1678584192","avatar_normal":"https://cdn.v2ex.com/avatar/1e65/cc16/618407_normal.png?m=1678584192","avatar_large":"https://cdn.v2ex.com/avatar/1e65/cc16/618407_large.png?m=1678584192","avatar_xlarge":"https://cdn.v2ex.com/avatar/1e65/cc16/618407_xlarge.png?m=1678584192","avatar_xxlarge":"https://cdn.v2ex.com/avatar/1e65/cc16/618407_xlarge.png?m=1678584192","avatar_xxxlarge":"https://cdn.v2ex.com/avatar/1e65/cc16/618407_xlarge.png?m=1678584192","created":1678584099,"last_modified":1678584192},"last_reply_by":"Biggoldfish","last_touched":1683091247,"title":"Gmail 已经 461.5 MB，什么时候超过微信 608MB，感觉应该没有希望了～","url":"https://www.v2ex.com/t/936978","created":1683083738,"deleted":0,"content":"微信功能很丰富，608MB 似乎可以原谅。\r\n\r\nGmail 的 iOS App 功能很单一，就是个邮箱。\r\n\r\n谁能分析一下 google 在里面放了什么。或者如何逆向看看？","content_rendered":"<p>微信功能很丰富，608MB 似乎可以原谅。</p>\n<p>Gmail 的 iOS App 功能很单一，就是个邮箱。</p>\n<p>谁能分析一下 google 在里面放了什么。或者如何逆向看看？</p>\n","last_modified":1683083897,"replies":17,"id":936978},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/069d/3bb0/580_large.png?m=1647952441","name":"ios","avatar_normal":"https://cdn.v2ex.com/navatar/069d/3bb0/580_normal.png?m=1647952441","title":"iOS","url":"https://www.v2ex.com/go/ios","topics":3396,"footer":"","header":"运行于 Apple 移动设备上的操作系统。","title_alternative":"iOS","avatar_mini":"https://cdn.v2ex.com/navatar/069d/3bb0/580_mini.png?m=1647952441","stars":912,"aliases":[],"root":false,"id":580,"parent_node_name":"apple"},"member":{"id":67981,"username":"atao","url":"https://www.v2ex.com/u/atao","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/5e3e/9296/67981_mini.png?m=1667374761","avatar_normal":"https://cdn.v2ex.com/avatar/5e3e/9296/67981_normal.png?m=1667374761","avatar_large":"https://cdn.v2ex.com/avatar/5e3e/9296/67981_large.png?m=1667374761","created":1405391650,"last_modified":1667374761},"last_reply_by":"gabezhao","last_touched":1683090218,"title":"推荐 iOS 上的 Rime 输入法：仓","url":"https://www.v2ex.com/t/936966","created":1683081177,"deleted":0,"content":"个人感觉使用体验超过微信输入法\r\n\r\nhttps://github.com/imfuxiao/Hamster","content_rendered":"<p>个人感觉使用体验超过微信输入法</p>\n<p><a href=\"https://github.com/imfuxiao/Hamster\" rel=\"nofollow\">https://github.com/imfuxiao/Hamster</a></p>\n","last_modified":1683081177,"replies":17,"id":936966},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c74d/97b0/16_large.png?m=1650127281","name":"share","avatar_normal":"https://cdn.v2ex.com/navatar/c74d/97b0/16_normal.png?m=1650127281","title":"分享发现","url":"https://www.v2ex.com/go/share","topics":38290,"footer":"","header":"分享你看到的好玩的，有信息量的，欢迎从这里获取灵感。","title_alternative":"Share","avatar_mini":"https://cdn.v2ex.com/navatar/c74d/97b0/16_mini.png?m=1650127281","stars":5326,"aliases":[],"root":false,"id":16,"parent_node_name":"v2ex"},"member":{"id":168296,"username":"summerLast","url":"https://www.v2ex.com/u/summerLast","website":"weekendproject.space","twitter":"SUNXYZCHINA","psn":"","github":"weekend-project-space","btc":"","location":"","tagline":"","bio":"指尖敲击键盘释放出魔法的力量","avatar_mini":"https://cdn.v2ex.com/avatar/35b0/b52c/168296_mini.png?m=1678759580","avatar_normal":"https://cdn.v2ex.com/avatar/35b0/b52c/168296_normal.png?m=1678759580","avatar_large":"https://cdn.v2ex.com/avatar/35b0/b52c/168296_large.png?m=1678759580","created":1460649145,"last_modified":1678759580},"last_reply_by":"qrkxyz","last_touched":1683090519,"title":"中文优质 rss 源 top - 高质量信息","url":"https://www.v2ex.com/t/936952","created":1683075566,"deleted":0,"content":"现在这个时代随着越来越多的内容被创作出来，信息的质量并没有随着内容数量的提升而提升，整体的信息熵却越来越高，这些都是相对高质量的信息源，虽然无法改变整体的熵，却可以让局部的熵降低。\r\n\r\n特意整理出 webfollow 那些订阅人数最多的源,方便大家更便捷的获取更有质量的内容\r\n\r\n[top-rss-list]( https://github.com/weekend-project-space/top-rss-list)\r\n\r\n你有哪些高质量的源也可以讨论分享","content_rendered":"<p>现在这个时代随着越来越多的内容被创作出来，信息的质量并没有随着内容数量的提升而提升，整体的信息熵却越来越高，这些都是相对高质量的信息源，虽然无法改变整体的熵，却可以让局部的熵降低。</p>\n<p>特意整理出 webfollow 那些订阅人数最多的源,方便大家更便捷的获取更有质量的内容</p>\n<p><a href=\"https://github.com/weekend-project-space/top-rss-list\" rel=\"nofollow\">top-rss-list</a></p>\n<p>你有哪些高质量的源也可以讨论分享</p>\n","last_modified":1683075596,"replies":12,"id":936952},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1677911181","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1677911181","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":55503,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1677911181","stars":8359,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"id":222090,"username":"iorilu","url":"https://www.v2ex.com/u/iorilu","website":"guxiaotian.com","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"","bio":"guxiaotian.com\r\n微信公众号: 股小天机器人","avatar_mini":"https://cdn.v2ex.com/avatar/7121/0eb9/222090_mini.png?m=1682058732","avatar_normal":"https://cdn.v2ex.com/avatar/7121/0eb9/222090_normal.png?m=1682058732","avatar_large":"https://cdn.v2ex.com/avatar/7121/0eb9/222090_large.png?m=1682058732","created":1490055548,"last_modified":1682058732},"last_reply_by":"vituralfuture","last_touched":1683091551,"title":"看了几天 rust， 总结了一句话关于生命周期","url":"https://www.v2ex.com/t/936977","created":1683083362,"deleted":0,"content":"这个生命周期概念确实是 rust 独有\r\n\r\n虽然这个理论并不新鲜， 但 rust 是强制，作为程序员必须明确知道所有变量或对象的生命周期，而不是靠编译器或语言自己推理\r\n\r\n我总就一句话就是\r\n\r\n这里我指一个复杂对象，里面可以有对别的对象引用\r\n\r\n借我钱意思是引用我\r\n\r\n我借别人钱意思是引用别人\r\n\r\n所有借我钱的必须死我前面，这样我就能收回所有借出的钱\r\n\r\n但我借别人钱我得死别人前面，这样就不用还钱\r\n\r\n这样才能利益最大化啊。。","content_rendered":"这个生命周期概念确实是 rust 独有<br /><br />虽然这个理论并不新鲜， 但 rust 是强制，作为程序员必须明确知道所有变量或对象的生命周期，而不是靠编译器或语言自己推理<br /><br />我总就一句话就是<br /><br />这里我指一个复杂对象，里面可以有对别的对象引用<br /><br />借我钱意思是引用我<br /><br />我借别人钱意思是引用别人<br /><br />所有借我钱的必须死我前面，这样我就能收回所有借出的钱<br /><br />但我借别人钱我得死别人前面，这样就不用还钱<br /><br />这样才能利益最大化啊。。","last_modified":1683083580,"replies":11,"id":936977},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/f61d/6947/375_large.png?m=1658910399","name":"go","avatar_normal":"https://cdn.v2ex.com/navatar/f61d/6947/375_normal.png?m=1658910399","title":"Go 编程语言","url":"https://www.v2ex.com/go/go","topics":2642,"footer":"","header":"Go 是一个开源的编程语言，它能让构造简单、可靠且高效的软件变得容易。","title_alternative":"The Go Programming Language","avatar_mini":"https://cdn.v2ex.com/navatar/f61d/6947/375_mini.png?m=1658910399","stars":3549,"aliases":[],"root":false,"id":375,"parent_node_name":"programming"},"member":{"id":302009,"username":"craftx","url":"https://www.v2ex.com/u/craftx","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/4cd5/29bc/302009_mini.png?m=1677722816","avatar_normal":"https://cdn.v2ex.com/avatar/4cd5/29bc/302009_normal.png?m=1677722816","avatar_large":"https://cdn.v2ex.com/avatar/4cd5/29bc/302009_large.png?m=1677722816","created":1521599920,"last_modified":1677722816},"last_reply_by":"artnowben","last_touched":1683087272,"title":"有没有哪种编码格式，高效、兼容性好、支持 go 自定义序列化和反序列化？","url":"https://www.v2ex.com/t/936955","created":1683076524,"deleted":0,"content":"目前服务的 rpc ，都是 json rpc.\r\n优点自然是兼容性好、一些开源结构（比如 shopspring/decimal ）都自带 json 支持。\r\n如果真的遇到奇葩的，还可以自定义序列化和反序列化。\r\n \r\n但缺点：低效。\r\n\r\n找替换的话，首先想到的是 protobuf 。高效是高效，无奈使用不便，兼容性是个大问题。比如时间，就不能直接 time.Time 。\r\n\r\n看大家有没有好的替代推荐。","content_rendered":"目前服务的 rpc ，都是 json rpc.<br />优点自然是兼容性好、一些开源结构（比如 shopspring/decimal ）都自带 json 支持。<br />如果真的遇到奇葩的，还可以自定义序列化和反序列化。<br /> <br />但缺点：低效。<br /><br />找替换的话，首先想到的是 protobuf 。高效是高效，无奈使用不便，兼容性是个大问题。比如时间，就不能直接 time.Time 。<br /><br />看大家有没有好的替代推荐。","last_modified":1683076524,"replies":9,"id":936955},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/03af/dbd6/63_large.png?m=1644490200","name":"java","avatar_normal":"https://cdn.v2ex.com/navatar/03af/dbd6/63_normal.png?m=1644490200","title":"Java","url":"https://www.v2ex.com/go/java","topics":5424,"footer":"","header":"Sun 公司发明，被广泛使用的一门编程语言。","title_alternative":"Java","avatar_mini":"https://cdn.v2ex.com/navatar/03af/dbd6/63_mini.png?m=1644490200","stars":5270,"aliases":[],"root":false,"id":63,"parent_node_name":"programming"},"member":{"id":494545,"username":"byte10","url":"https://www.v2ex.com/u/byte10","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/f72c/3766/494545_mini.png?m=1592034099","avatar_normal":"https://cdn.v2ex.com/avatar/f72c/3766/494545_normal.png?m=1592034099","avatar_large":"https://cdn.v2ex.com/avatar/f72c/3766/494545_large.png?m=1592034099","created":1592017018,"last_modified":1592034099},"last_reply_by":"lixintcwdsg","last_touched":1683049497,"title":"有没有 vert.x 或者有关注 Java 虚拟线程的群","url":"https://www.v2ex.com/t/936958","created":1683078357,"deleted":0,"content":"## 一、背景\r\n最近使用 vert.x 在开发一个 java 程序，只所以用 vert.x 就是因为它比较适合开发这类的程序。但是异步编程开发起来实在不好维护。。实现也太麻烦了，实在是太复杂了。下单完还要判断是否成功，还有循环下单等，很多时候异步实现起来非常的不好实现和阅读。\r\n\r\n## 二、引入虚拟线程\r\n目前引入的虚拟线程遇到非常大的麻烦。一般一个 verticle 绑定一个 eventloop 线程，我把虚拟线程绑定 vert.x eventloop 的线程中，，这样每个 verticle 内使用的所有虚拟线程也是它们自己平台 eventloop 线程，也就是在 verticle 使用的所有虚拟线程和自己平台线程 都是同一个线程，所以理论也是线程安全的。目前遇到的是虚拟线程和它自己的平台线程在执行 log 日志输出的时候，就会遇到死锁。也就是虚拟线程和它自己的平台线程发生了竞争 log.info 的输出。\r\n\r\n### 下面是异常日志：\r\n\r\n```\r\nThread Thread[#63,vert.x-eventloop-thread-1,5,main] has been blocked for 10586 ms, time limit is 2000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at java.base/jdk.internal.misc.Unsafe.park(Native Method)\r\n        at java.base/java.util.concurrent.locks.LockSupport.park(LockSupport.java:221)\r\n        at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:754)\r\n        at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:990)\r\n        at java.base/java.util.concurrent.locks.ReentrantLock$Sync.lock(ReentrantLock.java:153)\r\n        at java.base/java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:322)\r\n        at ch.qos.logback.core.OutputStreamAppender.writeBytes(OutputStreamAppender.java:200)\r\n        at ch.qos.logback.core.OutputStreamAppender.writeOut(OutputStreamAppender.java:193)\r\n        at ch.qos.logback.core.OutputStreamAppender.subAppend(OutputStreamAppender.java:228)\r\n        at ch.qos.logback.core.OutputStreamAppender.append(OutputStreamAppender.java:102)\r\n        at ch.qos.logback.core.UnsynchronizedAppenderBase.doAppend(UnsynchronizedAppenderBase.java:85)\r\n        at ch.qos.logback.core.spi.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:51)\r\n        at ch.qos.logback.classic.Logger.appendLoopOnAppenders(Logger.java:272)\r\n        at ch.qos.logback.classic.Logger.callAppenders(Logger.java:259)\r\n        at ch.qos.logback.classic.Logger.buildLoggingEventAndAppend(Logger.java:426)\r\n```\r\n\r\n使用 jstack -l pid 检查确实一直 block 中.\r\n\r\n```\r\nLockSupport.class\r\n\r\npublic static void park(Object blocker) {\r\n        Thread t = Thread.currentThread();\r\n        setBlocker(t, blocker);\r\n        try {\r\n            if (t.isVirtual()) {\r\n                VirtualThreads.park();\r\n            } else {\r\n                U.park(false, 0L);\r\n            }\r\n        } finally {\r\n            setBlocker(t, null);\r\n        }\r\n    }\r\n\r\n```\r\n\r\n由于 verticle 可能是很多个，可能会绑定到同一个 eventloop 线程，所以很难从代码上比较难规避不使用 eventloop 平台线程 。\r\n\r\n一般使用 ReentrantLock.lock 产生死锁的情况是什么原因呢？个人感觉跟 vert.x 关系不大，应该跟虚拟线程的有关系。\r\n\r\n目前不确定是否 ReentrantLock.lock 的问题，还是 logback 日志框架的问题。尝试直接用 ReentrantLock.lock 进行测试，额-也没有复现。。。但是用 log.info 打印日志必现。","content_rendered":"<h2>一、背景</h2>\n<p>最近使用 vert.x 在开发一个 java 程序，只所以用 vert.x 就是因为它比较适合开发这类的程序。但是异步编程开发起来实在不好维护。。实现也太麻烦了，实在是太复杂了。下单完还要判断是否成功，还有循环下单等，很多时候异步实现起来非常的不好实现和阅读。</p>\n<h2>二、引入虚拟线程</h2>\n<p>目前引入的虚拟线程遇到非常大的麻烦。一般一个 verticle 绑定一个 eventloop 线程，我把虚拟线程绑定 vert.x eventloop 的线程中，，这样每个 verticle 内使用的所有虚拟线程也是它们自己平台 eventloop 线程，也就是在 verticle 使用的所有虚拟线程和自己平台线程 都是同一个线程，所以理论也是线程安全的。目前遇到的是虚拟线程和它自己的平台线程在执行 log 日志输出的时候，就会遇到死锁。也就是虚拟线程和它自己的平台线程发生了竞争 <a href=\"http://log.info\" rel=\"nofollow\">log.info</a> 的输出。</p>\n<h3>下面是异常日志：</h3>\n<pre><code>Thread Thread[#63,vert.x-eventloop-thread-1,5,main] has been blocked for 10586 ms, time limit is 2000 ms\nio.vertx.core.VertxException: Thread blocked\n        at java.base/jdk.internal.misc.Unsafe.park(Native Method)\n        at java.base/java.util.concurrent.locks.LockSupport.park(LockSupport.java:221)\n        at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:754)\n        at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:990)\n        at java.base/java.util.concurrent.locks.ReentrantLock$Sync.lock(ReentrantLock.java:153)\n        at java.base/java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:322)\n        at ch.qos.logback.core.OutputStreamAppender.writeBytes(OutputStreamAppender.java:200)\n        at ch.qos.logback.core.OutputStreamAppender.writeOut(OutputStreamAppender.java:193)\n        at ch.qos.logback.core.OutputStreamAppender.subAppend(OutputStreamAppender.java:228)\n        at ch.qos.logback.core.OutputStreamAppender.append(OutputStreamAppender.java:102)\n        at ch.qos.logback.core.UnsynchronizedAppenderBase.doAppend(UnsynchronizedAppenderBase.java:85)\n        at ch.qos.logback.core.spi.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:51)\n        at ch.qos.logback.classic.Logger.appendLoopOnAppenders(Logger.java:272)\n        at ch.qos.logback.classic.Logger.callAppenders(Logger.java:259)\n        at ch.qos.logback.classic.Logger.buildLoggingEventAndAppend(Logger.java:426)\n</code></pre>\n<p>使用 jstack -l pid 检查确实一直 block 中.</p>\n<pre><code>LockSupport.class\n\npublic static void park(Object blocker) {\n        Thread t = Thread.currentThread();\n        setBlocker(t, blocker);\n        try {\n            if (t.isVirtual()) {\n                VirtualThreads.park();\n            } else {\n                U.park(false, 0L);\n            }\n        } finally {\n            setBlocker(t, null);\n        }\n    }\n\n</code></pre>\n<p>由于 verticle 可能是很多个，可能会绑定到同一个 eventloop 线程，所以很难从代码上比较难规避不使用 eventloop 平台线程 。</p>\n<p>一般使用 ReentrantLock.lock 产生死锁的情况是什么原因呢？个人感觉跟 vert.x 关系不大，应该跟虚拟线程的有关系。</p>\n<p>目前不确定是否 ReentrantLock.lock 的问题，还是 logback 日志框架的问题。尝试直接用 ReentrantLock.lock 进行测试，额-也没有复现。。。但是用 <a href=\"http://log.info\" rel=\"nofollow\">log.info</a> 打印日志必现。</p>\n","last_modified":1683078873,"replies":8,"id":936958},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":202418,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340","stars":3789,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":192680,"username":"lidage","url":"https://www.v2ex.com/u/lidage","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/fa9ae9a1d2d50189a18bc33036f35427?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/fa9ae9a1d2d50189a18bc33036f35427?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/fa9ae9a1d2d50189a18bc33036f35427?s=73&d=retro","created":1474369816,"last_modified":1474370409},"last_reply_by":"bilibilifk2","last_touched":1683014041,"title":"五一和女朋友去拍婚纱照了，可是对自己的发型不满意，怎么 P 一个发型阿","url":"https://www.v2ex.com/t/936956","created":1683077833,"deleted":0,"content":"问了拍婚纱的人，她们说她们做不了 P 头发，淘宝也问了好几家，无法换一个发型，都 2023 年了，连 P 头发也这么难做吗，V 友们有啥办法吗","content_rendered":"问了拍婚纱的人，她们说她们做不了 P 头发，淘宝也问了好几家，无法换一个发型，都 2023 年了，连 P 头发也这么难做吗，V 友们有啥办法吗","last_modified":1683077833,"replies":8,"id":936956},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":202418,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340","stars":3789,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":612854,"username":"2902","url":"https://www.v2ex.com/u/2902","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/9a8857e51d291a1b72dbebcc039c0488?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/9a8857e51d291a1b72dbebcc039c0488?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/9a8857e51d291a1b72dbebcc039c0488?s=73&d=retro","created":1675783433,"last_modified":1675783433},"last_reply_by":"2902","last_touched":1683091652,"title":"Paypal 的 35 刀手续费花哪儿了","url":"https://www.v2ex.com/t/936982","created":1683086486,"deleted":0,"content":"接上贴后续，5.1 提现的 100 刀，扣掉 35 刀手续费，今天还没到账，问客服说 5.4 ～ 5.8 才能到账，但是前端页面明明显示 1 个工作日，而且钱 Paypal 那边说已经发出去了，没法撤销，只是一句抱歉就没了\r\n\r\n转经理也是一个态度，当我找茬的，态度很强硬，说我不接受可以自己挂电话，除了等没有其他解决办法了。\r\n\r\n我怎么感觉自己被骗了，美国银行也有五一小长假吗？\r\n\r\nPaypal 是不是在搞欺诈","content_rendered":"<p>接上贴后续，5.1 提现的 100 刀，扣掉 35 刀手续费，今天还没到账，问客服说 5.4 ～ 5.8 才能到账，但是前端页面明明显示 1 个工作日，而且钱 Paypal 那边说已经发出去了，没法撤销，只是一句抱歉就没了</p>\n<p>转经理也是一个态度，当我找茬的，态度很强硬，说我不接受可以自己挂电话，除了等没有其他解决办法了。</p>\n<p>我怎么感觉自己被骗了，美国银行也有五一小长假吗？</p>\n<p>Paypal 是不是在搞欺诈</p>\n","last_modified":1683086715,"replies":6,"id":936982},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6e27/13a6/557_large.png?m=1608969785","name":"life","avatar_normal":"https://cdn.v2ex.com/navatar/6e27/13a6/557_normal.png?m=1608969785","title":"生活","url":"https://www.v2ex.com/go/life","topics":4265,"footer":"","header":"生活中的技术讨论","title_alternative":"Life","avatar_mini":"https://cdn.v2ex.com/navatar/6e27/13a6/557_mini.png?m=1608969785","stars":1108,"aliases":[],"root":false,"id":557,"parent_node_name":""},"member":{"id":483889,"username":"fujiayu0224","url":"https://www.v2ex.com/u/fujiayu0224","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/dd9af5665ee4c362dd04ce8e0118bb0b?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/dd9af5665ee4c362dd04ce8e0118bb0b?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/dd9af5665ee4c362dd04ce8e0118bb0b?s=73&d=retro","created":1586949531,"last_modified":1586949531},"last_reply_by":"realfatboy","last_touched":1683091612,"title":"2023 年求推荐个电视盒子","url":"https://www.v2ex.com/t/936972","created":1683081995,"deleted":0,"content":"家里有太电视，但是自带的系统太卡太卡了，想接电视盒子用，连家里 nas ，求推荐一个。感谢感谢。","content_rendered":"家里有太电视，但是自带的系统太卡太卡了，想接电视盒子用，连家里 nas ，求推荐一个。感谢感谢。","last_modified":1683081995,"replies":6,"id":936972}]