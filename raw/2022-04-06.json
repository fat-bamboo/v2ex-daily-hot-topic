[{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/e4da/3b7f/5_large.png?m=1584385880","name":"movie","avatar_normal":"https://cdn.v2ex.com/navatar/e4da/3b7f/5_normal.png?m=1584385880","title":"电影","url":"https://www.v2ex.com/go/movie","topics":1226,"footer":"","header":"用 90 分钟去体验另外一个世界。","title_alternative":"Movie","avatar_mini":"https://cdn.v2ex.com/navatar/e4da/3b7f/5_mini.png?m=1584385880","stars":1774,"aliases":[],"root":false,"id":5,"parent_node_name":"life"},"member":{"id":135006,"username":"awesomes","url":"https://www.v2ex.com/u/awesomes","website":"","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/cb44/483e/135006_mini.png?m=1560995176","avatar_normal":"https://cdn.v2ex.com/avatar/cb44/483e/135006_normal.png?m=1560995176","avatar_large":"https://cdn.v2ex.com/avatar/cb44/483e/135006_large.png?m=1560995176","created":1440483966,"last_modified":1560995176},"last_reply_by":"nobodyknows","last_touched":1649218033,"title":"求公路片","url":"https://www.v2ex.com/t/845133","created":1649208694,"deleted":0,"content":"对于常年坐在办公室的我尤其喜欢看公路片，个人比较喜欢的公路片有《后会无期》、《人在囧途》第一部、《落叶归根》 求推荐更多其它的。","content_rendered":"<p>对于常年坐在办公室的我尤其喜欢看公路片，个人比较喜欢的公路片有《后会无期》、《人在囧途》第一部、《落叶归根》 求推荐更多其它的。</p>\n","last_modified":1649208694,"replies":59,"id":845133},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1648813467","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1648813467","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":48125,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1648813467","stars":7765,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"id":351317,"username":"xzh20121116g","url":"https://www.v2ex.com/u/xzh20121116g","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/40ff5b355d19ce4300c26415134cd6e8?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/40ff5b355d19ce4300c26415134cd6e8?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/40ff5b355d19ce4300c26415134cd6e8?s=73&d=retro","created":1537517016,"last_modified":1537517016},"last_reply_by":"angryfish","last_touched":1649217624,"title":"公司环境有 ip 白名单，居家办公时如何固定 ip，避免频繁麻烦运维人员添加 ip","url":"https://www.v2ex.com/t/845145","created":1649211275,"deleted":0,"content":"或者有没有类似的服务，让我以同一个 ip 访问外部","content_rendered":"<p>或者有没有类似的服务，让我以同一个 ip 访问外部</p>\n","last_modified":1649211297,"replies":34,"id":845145},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6e27/13a6/557_large.png?m=1608969785","name":"life","avatar_normal":"https://cdn.v2ex.com/navatar/6e27/13a6/557_normal.png?m=1608969785","title":"生活","url":"https://www.v2ex.com/go/life","topics":3050,"footer":"","header":"生活中的技术讨论","title_alternative":"Life","avatar_mini":"https://cdn.v2ex.com/navatar/6e27/13a6/557_mini.png?m=1608969785","stars":804,"aliases":[],"root":false,"id":557,"parent_node_name":""},"member":{"id":504746,"username":"liudaolunhuibl","url":"https://www.v2ex.com/u/liudaolunhuibl","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/37d4/6957/504746_mini.png?m=1619054801","avatar_normal":"https://cdn.v2ex.com/avatar/37d4/6957/504746_normal.png?m=1619054801","avatar_large":"https://cdn.v2ex.com/avatar/37d4/6957/504746_large.png?m=1619054801","created":1597971891,"last_modified":1619054801},"last_reply_by":"danhahaha","last_touched":1649216826,"title":"大家平时有记账的习惯吗","url":"https://www.v2ex.com/t/845138","created":1649209494,"deleted":0,"content":"基本上记账全靠银行 app ，一个月大概要花三四千左右，没有房租没有房贷","content_rendered":"<p>基本上记账全靠银行 app ，一个月大概要花三四千左右，没有房租没有房贷</p>\n","last_modified":1649209494,"replies":30,"id":845138},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1647188067","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1647188067","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":183220,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1647188067","stars":3447,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":341424,"username":"balabalaguguji","url":"https://www.v2ex.com/u/balabalaguguji","website":"https://tools.fun","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"","bio":"创业者，工具箱：https://tools.fun，SVN托管：https://svnbucket.com，API文档、测试：https://easydoc.net","avatar_mini":"https://cdn.v2ex.com/avatar/1383/cc45/341424_mini.png?m=1635302395","avatar_normal":"https://cdn.v2ex.com/avatar/1383/cc45/341424_normal.png?m=1635302395","avatar_large":"https://cdn.v2ex.com/avatar/1383/cc45/341424_large.png?m=1635302395","created":1534320435,"last_modified":1635302395},"last_reply_by":"kaishi123","last_touched":1649213019,"title":"怎么举报乱停车到人行道的车","url":"https://www.v2ex.com/t/845122","created":1649205018,"deleted":0,"content":"店铺门口晚上总是有人想要停车到人行道上，叫他开车就是不开，“有本事叫交警拖走呀”\r\n\r\n对于这种人有什么好办法呢","content_rendered":"<p>店铺门口晚上总是有人想要停车到人行道上，叫他开车就是不开，“有本事叫交警拖走呀”</p>\n<p>对于这种人有什么好办法呢</p>\n","last_modified":1649205018,"replies":23,"id":845122},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c74d/97b0/16_large.png?m=1648461077","name":"share","avatar_normal":"https://cdn.v2ex.com/navatar/c74d/97b0/16_normal.png?m=1648461077","title":"分享发现","url":"https://www.v2ex.com/go/share","topics":35276,"footer":"","header":"分享你看到的好玩的，有信息量的，欢迎从这里获取灵感。","title_alternative":"Share","avatar_mini":"https://cdn.v2ex.com/navatar/c74d/97b0/16_mini.png?m=1648461077","stars":4776,"aliases":[],"root":false,"id":16,"parent_node_name":"v2ex"},"member":{"id":191379,"username":"wfwdex","url":"https://www.v2ex.com/u/wfwdex","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/6d2d/8018/191379_mini.png?m=1473646850","avatar_normal":"https://cdn.v2ex.com/avatar/6d2d/8018/191379_normal.png?m=1473646850","avatar_large":"https://cdn.v2ex.com/avatar/6d2d/8018/191379_large.png?m=1473646850","created":1473646832,"last_modified":1473646850},"last_reply_by":"czfy","last_touched":1649218311,"title":"请分享一下那些你认为小而美的产品","url":"https://www.v2ex.com/t/845173","created":1649214724,"deleted":0,"content":"web 应用，App 都可以，我先来:\r\n\r\n- [typlog]( https://typlog.com/)\r\n- [50 音]( https://apps.apple.com/cn/app/50%E9%9F%B3%E8%B5%B7%E6%BA%90-%E6%97%A5%E8%AF%AD%E4%BA%94%E5%8D%81%E9%9F%B3%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/id1439222882)","content_rendered":"<p>web 应用，App 都可以，我先来:</p>\n<ul>\n<li><a href=\"https://typlog.com/\" rel=\"nofollow\">typlog</a></li>\n<li><a href=\"https://apps.apple.com/cn/app/50%E9%9F%B3%E8%B5%B7%E6%BA%90-%E6%97%A5%E8%AF%AD%E4%BA%94%E5%8D%81%E9%9F%B3%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/id1439222882\" rel=\"nofollow\">50 音</a></li>\n</ul>\n","last_modified":1649214724,"replies":22,"id":845173},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1648813467","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1648813467","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":48125,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1648813467","stars":7765,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"id":476973,"username":"Ds97","url":"https://www.v2ex.com/u/Ds97","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/fc15db081abfb97ffa7558260ada153c?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/fc15db081abfb97ffa7558260ada153c?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/fc15db081abfb97ffa7558260ada153c?s=73&d=retro","created":1584345253,"last_modified":1584345253},"last_reply_by":"Carseason","last_touched":1649214823,"title":"验证短信码被盗刷怎么办","url":"https://www.v2ex.com/t/845136","created":1649209056,"deleted":0,"content":"1.限制了一个号码一分钟之内只能发一次\r\n2.一个号码一个小时最多 6 次\r\n3.一个 ip 一天最多 10 次\r\n4.阿里云的滑块验证\r\n以上的这些验证都是生效的，但还是被刷了上万条，都是换不同号码，号码前面部分是固定的，后面几位数随机的，ip 也是换着来的，有成百上千个 ip ，阿里云的滑块验证也通过了，用机器是怎么滑动那个滑块的啊，一脸懵逼。请问这种情况该怎么防啊","content_rendered":"<p>1.限制了一个号码一分钟之内只能发一次\n2.一个号码一个小时最多 6 次\n3.一个 ip 一天最多 10 次\n4.阿里云的滑块验证\n以上的这些验证都是生效的，但还是被刷了上万条，都是换不同号码，号码前面部分是固定的，后面几位数随机的，ip 也是换着来的，有成百上千个 ip ，阿里云的滑块验证也通过了，用机器是怎么滑动那个滑块的啊，一脸懵逼。请问这种情况该怎么防啊</p>\n","last_modified":1649209056,"replies":21,"id":845136},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1647188067","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1647188067","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":183220,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1647188067","stars":3447,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":576704,"username":"airbotgo","url":"https://www.v2ex.com/u/airbotgo","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/gravatar/2d8f9a5b4fbddc9e8307b207222e9938?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/2d8f9a5b4fbddc9e8307b207222e9938?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/2d8f9a5b4fbddc9e8307b207222e9938?s=73&d=retro","created":1648272585,"last_modified":1648272585},"last_reply_by":"Chad0000","last_touched":1649213135,"title":"个人隐私数据如何加密上传到网盘空间？","url":"https://www.v2ex.com/t/845121","created":1649204029,"deleted":0,"content":"1 、通过常用的 .rar 、.zip 压缩工具，配合密码可行吗？是否有通用的破解方案？\r\n2 、有其它效率不错的加密、解密工具推荐吗？","content_rendered":"1 、通过常用的 .rar 、.zip 压缩工具，配合密码可行吗？是否有通用的破解方案？<br />2 、有其它效率不错的加密、解密工具推荐吗？","last_modified":1649204029,"replies":20,"id":845121},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6e27/13a6/557_large.png?m=1608969785","name":"life","avatar_normal":"https://cdn.v2ex.com/navatar/6e27/13a6/557_normal.png?m=1608969785","title":"生活","url":"https://www.v2ex.com/go/life","topics":3050,"footer":"","header":"生活中的技术讨论","title_alternative":"Life","avatar_mini":"https://cdn.v2ex.com/navatar/6e27/13a6/557_mini.png?m=1608969785","stars":804,"aliases":[],"root":false,"id":557,"parent_node_name":""},"member":{"id":204582,"username":"SkYouth","url":"https://www.v2ex.com/u/SkYouth","website":"","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/fb9a/75e3/204582_mini.png?m=1640941837","avatar_normal":"https://cdn.v2ex.com/avatar/fb9a/75e3/204582_normal.png?m=1640941837","avatar_large":"https://cdn.v2ex.com/avatar/fb9a/75e3/204582_large.png?m=1640941837","created":1480991390,"last_modified":1640941837},"last_reply_by":"cat9life","last_touched":1649216944,"title":"这两天心情有点低落。","url":"https://www.v2ex.com/t/845159","created":1649213245,"deleted":0,"content":"楼下的邻居 4 日早上，骑电动车出门买菜招到”开门杀“，2 天过去了还在 ICU ，希望渺茫。\r\n\r\n前一天晚上还看到出门溜娃（两个娃，大的才上一年级），第二天就遭遇变故。\r\n\r\n新车+临牌+违停，可能没有摄像头，司机现在还推诿。\r\n\r\n邻居没戴头盔，颅内出血严重。\r\n\r\n感觉很难受。","content_rendered":"<p>楼下的邻居 4 日早上，骑电动车出门买菜招到”开门杀“，2 天过去了还在 ICU ，希望渺茫。</p>\n<p>前一天晚上还看到出门溜娃（两个娃，大的才上一年级），第二天就遭遇变故。</p>\n<p>新车+临牌+违停，可能没有摄像头，司机现在还推诿。</p>\n<p>邻居没戴头盔，颅内出血严重。</p>\n<p>感觉很难受。</p>\n","last_modified":1649213245,"replies":19,"id":845159},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1647188067","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1647188067","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":183228,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1647188067","stars":3447,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":150997,"username":"qiaobeier","url":"https://www.v2ex.com/u/qiaobeier","website":"","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/c073/9ee6/150997_mini.png?m=1649212702","avatar_normal":"https://cdn.v2ex.com/avatar/c073/9ee6/150997_normal.png?m=1649212702","avatar_large":"https://cdn.v2ex.com/avatar/c073/9ee6/150997_large.png?m=1649212702","created":1449853485,"last_modified":1649212702},"last_reply_by":"crysislinux","last_touched":1649217772,"title":"上海的 Swift 停掉了？","url":"https://www.v2ex.com/t/845155","created":1649212731,"deleted":0,"content":"美国 31 号转的，应该 1~2 号就能收到，打总行客服说没有通知停，但是打本地银行专门划拨的电话没人接听。","content_rendered":"<p>美国 31 号转的，应该 1~2 号就能收到，打总行客服说没有通知停，但是打本地银行专门划拨的电话没人接听。</p>\n","last_modified":1649212731,"replies":18,"id":845155},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/1f0e/3dad/19_large.png?m=1648461098","name":"beijing","avatar_normal":"https://cdn.v2ex.com/navatar/1f0e/3dad/19_normal.png?m=1648461098","title":"北京","url":"https://www.v2ex.com/go/beijing","topics":3407,"footer":"","header":"","title_alternative":"Beijing","avatar_mini":"https://cdn.v2ex.com/navatar/1f0e/3dad/19_mini.png?m=1648461098","stars":1979,"aliases":[],"root":false,"id":19,"parent_node_name":"cn"},"member":{"id":436029,"username":"Alchemistboy","url":"https://www.v2ex.com/u/Alchemistboy","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/4ed6/a355/436029_mini.png?m=1637819710","avatar_normal":"https://cdn.v2ex.com/avatar/4ed6/a355/436029_normal.png?m=1637819710","avatar_large":"https://cdn.v2ex.com/avatar/4ed6/a355/436029_large.png?m=1637819710","created":1565831257,"last_modified":1637819710},"last_reply_by":"Leonard","last_touched":1649216092,"title":"请问大家北京居住证都是怎么办理的","url":"https://www.v2ex.com/t/845152","created":1649212076,"deleted":0,"content":"在北京通预约了，但是警察要 [工作日] 的 [工作时间] 才上门核实，这不是完全遇不上、办不了吗？","content_rendered":"在北京通预约了，但是警察要 [工作日] 的 [工作时间] 才上门核实，这不是完全遇不上、办不了吗？","last_modified":1649212076,"replies":14,"id":845152},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6e27/13a6/557_large.png?m=1608969785","name":"life","avatar_normal":"https://cdn.v2ex.com/navatar/6e27/13a6/557_normal.png?m=1608969785","title":"生活","url":"https://www.v2ex.com/go/life","topics":3050,"footer":"","header":"生活中的技术讨论","title_alternative":"Life","avatar_mini":"https://cdn.v2ex.com/navatar/6e27/13a6/557_mini.png?m=1608969785","stars":804,"aliases":[],"root":false,"id":557,"parent_node_name":""},"member":{"id":233173,"username":"rabbbit","url":"https://www.v2ex.com/u/rabbbit","website":"","twitter":"","psn":"","github":"Aaron-Bird","btc":"","location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/980c/4c78/233173_mini.png?m=1496167268","avatar_normal":"https://cdn.v2ex.com/avatar/980c/4c78/233173_normal.png?m=1496167268","avatar_large":"https://cdn.v2ex.com/avatar/980c/4c78/233173_large.png?m=1496167268","created":1496167130,"last_modified":1496167268},"last_reply_by":"rabbbit","last_touched":1649216618,"title":"身份证要过期了，过期之后银行卡啥的还能用吗？","url":"https://www.v2ex.com/t/845166","created":1649214125,"deleted":0,"content":"身份证要过期了，现在银行卡 支付宝一堆提示。\r\n疫情原因没法补办，过期了银行卡 支付宝 机票 火车票啥的有影响吗？\r\n\r\n鸡呗的，下次一定要找个不出差的工作。","content_rendered":"<p>身份证要过期了，现在银行卡 支付宝一堆提示。\n疫情原因没法补办，过期了银行卡 支付宝 机票 火车票啥的有影响吗？</p>\n<p>鸡呗的，下次一定要找个不出差的工作。</p>\n","last_modified":1649216135,"replies":13,"id":845166},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1648813467","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1648813467","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":48125,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1648813467","stars":7765,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"id":139333,"username":"makeitwork","url":"https://www.v2ex.com/u/makeitwork","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/ded4/7a13/139333_mini.png?m=1447334212","avatar_normal":"https://cdn.v2ex.com/avatar/ded4/7a13/139333_normal.png?m=1447334212","avatar_large":"https://cdn.v2ex.com/avatar/ded4/7a13/139333_large.png?m=1447334212","created":1442890018,"last_modified":1447334212},"last_reply_by":"whyrookie","last_touched":1649213061,"title":"作为大龄程序员，有考虑未来往区块链转吗？","url":"https://www.v2ex.com/t/845137","created":1649209150,"deleted":0,"content":"发现这种新技术，不限年龄，人才非常稀缺，团队也正在考虑招揽人才（几位大厂同事在副业搞搞游戏元宇宙）\r\n大家讨论一下，新的支付方式，新的信息机制，需要什么样的人才呢？","content_rendered":"<p>发现这种新技术，不限年龄，人才非常稀缺，团队也正在考虑招揽人才（几位大厂同事在副业搞搞游戏元宇宙）\n大家讨论一下，新的支付方式，新的信息机制，需要什么样的人才呢？</p>\n","last_modified":1649209150,"replies":13,"id":845137},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1647188067","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1647188067","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":183220,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1647188067","stars":3447,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":413277,"username":"Celebi","url":"https://www.v2ex.com/u/Celebi","website":"","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/865a/0526/413277_mini.png?m=1635735789","avatar_normal":"https://cdn.v2ex.com/avatar/865a/0526/413277_normal.png?m=1635735789","avatar_large":"https://cdn.v2ex.com/avatar/865a/0526/413277_large.png?m=1635735789","created":1558101006,"last_modified":1635735789},"last_reply_by":"vocaloid","last_touched":1649213359,"title":"只用来装国产软件， virtualbox 够用吗？","url":"https://www.v2ex.com/t/845127","created":1649206893,"deleted":0,"content":"想装个虚拟机，把 qq 、微信、企业微信、百度网盘丢进去，因为是在公司用，所以不想用几十块的 vmware ，正版的又太贵。。想问下只是用来养蛊的话 virtualbox 够用吗？","content_rendered":"<p>想装个虚拟机，把 qq 、微信、企业微信、百度网盘丢进去，因为是在公司用，所以不想用几十块的 vmware ，正版的又太贵。。想问下只是用来养蛊的话 virtualbox 够用吗？</p>\n","last_modified":1649206893,"replies":13,"id":845127},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6353/8fe6/519_large.png?m=1595507885","name":"ideas","avatar_normal":"https://cdn.v2ex.com/navatar/6353/8fe6/519_normal.png?m=1595507885","title":"奇思妙想","url":"https://www.v2ex.com/go/ideas","topics":4916,"footer":"","header":"让你的创意在这里自由流动吧。","title_alternative":"Ideas","avatar_mini":"https://cdn.v2ex.com/navatar/6353/8fe6/519_mini.png?m=1595507885","stars":2566,"aliases":[],"root":false,"id":519,"parent_node_name":"v2ex"},"member":{"id":410653,"username":"zhenzinian","url":"https://www.v2ex.com/u/zhenzinian","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/gravatar/a9e8bcd8bcfe6643ebc576b2f5c44b2d?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/a9e8bcd8bcfe6643ebc576b2f5c44b2d?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/a9e8bcd8bcfe6643ebc576b2f5c44b2d?s=73&d=retro","created":1557386646,"last_modified":1557386646},"last_reply_by":"kyro00000","last_touched":1649218689,"title":"有没有成熟的对赌平台？没有的话咱自建一个？","url":"https://www.v2ex.com/t/845184","created":1649216460,"deleted":0,"content":"这几天很明显的感觉到，墙内的人和墙外的人说着截然相反的论调。\r\n\r\n举个例子，欧洲某两国大战，墙外的人有更多样化的信息渠道，大概有 70%能够准确知晓局势发展，明白某俄败势已定\r\n\r\n墙内则完全是另一番景象，基本只根据自己零碎的既有知识，和墙内的新闻判断,一边倒地认为某俄能轻取某乌\r\n\r\n对于墙内群众这种长期的、大量的黑白颠倒的错误看法，自己每次看到心里觉得挺不舒服，包括身边周围人在内，常常在这些问题上引起争执\r\n\r\n我的想法是既然你可以造一堵墙来隔离信息，养成了一批成天义愤填膺，大呼小叫的狂徒，那我何不开发一个反制的工具呢？\r\n\r\n我想到的是，是否有这样的成熟的，有信誉的对赌平台\r\n\r\n能够对任意事实的正反两面押注\r\n\r\n比如对于此次战争，判断哪一方是最终胜利方\r\n\r\n再比如对于国内一直自信的防疫政策，最终会不会最终倒向共存模式\r\n\r\n我承认有这个想法的初衷并不怎么高尚，就是觉得既然你们嗓门这么大，为何不提供个机会让你们押注来证明自己的信心呢？（实际是想借这样的平台来给他们小小的惩罚，因为输的必然是他们，希望他们能对自己深信不疑的事实有所松动）\r\n\r\n同时让对于那些知道事实，无力辩驳的群体能有个把自己正确认知变现的机会。\r\n\r\n目前想到的几个问题:\r\n\r\n1.结果裁定： 因为用户面向国内，为了让双方信服，最终的结果判定就需要引用国内的权威媒体发布的信息。比如人民日报一类，而这些媒体在某些事实上会一条道走到黑。\r\n那么就需要发起对赌的用户，不仅要对自己的判断有十足把握，还要预判墙内媒体无法对后续最终事实进行某黑\r\n\r\n2.事件数量： 全民关注的国际大事毕竟是少数，如果仅仅把事件局限于此是自束手脚，所以用户可以自由发起任何领域事件的对赌，不做限制\r\n\r\n3.被墙： 这点还没想好对策，虽然不涉及内容，但是如果做大了，被墙也是大概率\r\n\r\n4.推广： 这涉及到怎么找引爆点，这是最难的部分了，求 v 友们出谋划策","content_rendered":"<p>这几天很明显的感觉到，墙内的人和墙外的人说着截然相反的论调。</p>\n<p>举个例子，欧洲某两国大战，墙外的人有更多样化的信息渠道，大概有 70%能够准确知晓局势发展，明白某俄败势已定</p>\n<p>墙内则完全是另一番景象，基本只根据自己零碎的既有知识，和墙内的新闻判断,一边倒地认为某俄能轻取某乌</p>\n<p>对于墙内群众这种长期的、大量的黑白颠倒的错误看法，自己每次看到心里觉得挺不舒服，包括身边周围人在内，常常在这些问题上引起争执</p>\n<p>我的想法是既然你可以造一堵墙来隔离信息，养成了一批成天义愤填膺，大呼小叫的狂徒，那我何不开发一个反制的工具呢？</p>\n<p>我想到的是，是否有这样的成熟的，有信誉的对赌平台</p>\n<p>能够对任意事实的正反两面押注</p>\n<p>比如对于此次战争，判断哪一方是最终胜利方</p>\n<p>再比如对于国内一直自信的防疫政策，最终会不会最终倒向共存模式</p>\n<p>我承认有这个想法的初衷并不怎么高尚，就是觉得既然你们嗓门这么大，为何不提供个机会让你们押注来证明自己的信心呢？（实际是想借这样的平台来给他们小小的惩罚，因为输的必然是他们，希望他们能对自己深信不疑的事实有所松动）</p>\n<p>同时让对于那些知道事实，无力辩驳的群体能有个把自己正确认知变现的机会。</p>\n<p>目前想到的几个问题:</p>\n<p>1.结果裁定： 因为用户面向国内，为了让双方信服，最终的结果判定就需要引用国内的权威媒体发布的信息。比如人民日报一类，而这些媒体在某些事实上会一条道走到黑。\n那么就需要发起对赌的用户，不仅要对自己的判断有十足把握，还要预判墙内媒体无法对后续最终事实进行某黑</p>\n<p>2.事件数量： 全民关注的国际大事毕竟是少数，如果仅仅把事件局限于此是自束手脚，所以用户可以自由发起任何领域事件的对赌，不做限制</p>\n<p>3.被墙： 这点还没想好对策，虽然不涉及内容，但是如果做大了，被墙也是大概率</p>\n<p>4.推广： 这涉及到怎么找引爆点，这是最难的部分了，求 v 友们出谋划策</p>\n","last_modified":1649216460,"replies":12,"id":845184},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1647188067","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1647188067","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":183228,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1647188067","stars":3447,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":487194,"username":"jiobanma","url":"https://www.v2ex.com/u/jiobanma","website":"www.banmajio.com","twitter":"","psn":"","github":"banmajio","btc":"","location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/581b/1335/487194_mini.png?m=1601286723","avatar_normal":"https://cdn.v2ex.com/avatar/581b/1335/487194_normal.png?m=1601286723","avatar_large":"https://cdn.v2ex.com/avatar/581b/1335/487194_large.png?m=1601286723","created":1588228908,"last_modified":1601286723},"last_reply_by":"cgb1021","last_touched":1649218475,"title":"大家房租占工资比例多少","url":"https://www.v2ex.com/t/845182","created":1649215891,"deleted":0,"content":"坐标北京,房租占工资 25%","content_rendered":"<p>坐标北京,房租占工资 25%</p>\n","last_modified":1649215891,"replies":12,"id":845182},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/27ed/0fb9/1039_large.png?m=1601353687","name":"k8s","avatar_normal":"https://cdn.v2ex.com/navatar/27ed/0fb9/1039_normal.png?m=1601353687","title":"Kubernetes","url":"https://www.v2ex.com/go/k8s","topics":337,"footer":"","header":"适用于大规模生产环境的容器编排管理平台。","title_alternative":"Kubernetes","avatar_mini":"https://cdn.v2ex.com/navatar/27ed/0fb9/1039_mini.png?m=1601353687","stars":511,"aliases":[],"root":false,"id":1039,"parent_node_name":"cloud"},"member":{"id":555634,"username":"itechnology","url":"https://www.v2ex.com/u/itechnology","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/ceca/7efb/555634_mini.png?m=1648864285","avatar_normal":"https://cdn.v2ex.com/avatar/ceca/7efb/555634_normal.png?m=1648864285","avatar_large":"https://cdn.v2ex.com/avatar/ceca/7efb/555634_large.png?m=1648864285","created":1631237690,"last_modified":1648864285},"last_reply_by":"itechnology","last_touched":1649216344,"title":"想业余时间写一个 Java 项目，用上 spring cloud、es、rabbitmq、docker、k8s 等技术，写什么项目比较好？","url":"https://www.v2ex.com/t/845141","created":1649210125,"deleted":0,"content":"如题，主要是学习+实践技术，因为工作中不一定会用到所有技术","content_rendered":"<p>如题，主要是学习+实践技术，因为工作中不一定会用到所有技术</p>\n","last_modified":1649210125,"replies":12,"id":845141},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_large.png?m=1648291943","name":"career","avatar_normal":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_normal.png?m=1648291943","title":"职场话题","url":"https://www.v2ex.com/go/career","topics":12912,"footer":"","header":"这里，我们聊聊那些工作中遇到的开心和不开心的事。","title_alternative":"Career","avatar_mini":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_mini.png?m=1648291943","stars":2305,"aliases":[],"root":false,"id":770,"parent_node_name":"work"},"member":{"id":464003,"username":"kilims","url":"https://www.v2ex.com/u/kilims","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/bdd7f75551778b38a520eb81b410178e?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/bdd7f75551778b38a520eb81b410178e?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/bdd7f75551778b38a520eb81b410178e?s=73&d=retro","created":1578541012,"last_modified":1578541012},"last_reply_by":"gynantim","last_touched":1649214798,"title":"Offer 取舍，某知名大厂与某金融科技公司","url":"https://www.v2ex.com/t/845131","created":1649208525,"deleted":0,"content":"两者的总 package 都差不多\r\n\r\n知名大厂优势：xx 一年，人间三年，进去出来，去哪都有个大厂 tittle ，对中小厂可能属于降维打击？加之其他大厂也好互跳\r\n知名大厂劣势：加班\r\n\r\n某金融科技公司优势：抛了个橄榄枝，新技术探索部门，可以实践前沿新技术；一直是金融科技背景，选这个也算如一而终；不加班+在家办公；\r\n某金融科技公司劣势：没有”牌子效应“\r\n\r\n毕业即将 5 年，一直没选择去大厂，两者总 package 都还算可观，取舍想咨询下各位吴彦祖的建议","content_rendered":"两者的总 package 都差不多<br /><br />知名大厂优势：xx 一年，人间三年，进去出来，去哪都有个大厂 tittle ，对中小厂可能属于降维打击？加之其他大厂也好互跳<br />知名大厂劣势：加班<br /><br />某金融科技公司优势：抛了个橄榄枝，新技术探索部门，可以实践前沿新技术；一直是金融科技背景，选这个也算如一而终；不加班+在家办公；<br />某金融科技公司劣势：没有”牌子效应“<br /><br />毕业即将 5 年，一直没选择去大厂，两者总 package 都还算可观，取舍想咨询下各位吴彦祖的建议","last_modified":1649208525,"replies":11,"id":845131},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_large.png?m=1648291943","name":"career","avatar_normal":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_normal.png?m=1648291943","title":"职场话题","url":"https://www.v2ex.com/go/career","topics":12912,"footer":"","header":"这里，我们聊聊那些工作中遇到的开心和不开心的事。","title_alternative":"Career","avatar_mini":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_mini.png?m=1648291943","stars":2305,"aliases":[],"root":false,"id":770,"parent_node_name":"work"},"member":{"id":382760,"username":"rophie123","url":"https://www.v2ex.com/u/rophie123","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/gravatar/5c8d369b073fddd235c018d1235eae31?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/5c8d369b073fddd235c018d1235eae31?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/5c8d369b073fddd235c018d1235eae31?s=73&d=retro","created":1549801485,"last_modified":1640050487},"last_reply_by":"Greenm","last_touched":1649214633,"title":"删库跑路后续， 8000 块压倒骆驼的最后一棵稻草","url":"https://www.v2ex.com/t/845147","created":1649211376,"deleted":0,"content":"原帖[/t/843509](/t/843509)\r\n\r\n4 月初，一直毫无动静，感觉情况不对，从其他被开的员工那里打听到，由于年前大量扩张，老系统被卡脖子（用的是第三方的，所以才找我开发新的），加上年后 YQ （主要靠招商加盟）没有开单，公司已经分崩离析，大量开人，本来就干不下去了想转行，现在正好以此为接口，对代理商宣称系统被黑，全停了（不得谢谢我）\r\n\r\n清明期间，项目负责人一直联系我见面，说能给钱，他能决定。见面后确认公司情况属实，几个股东已撤，现在就是拖着，他也抱怨那个老板，表示想单干，目前还在公司有利可图，并且手里有 200+代理商，希望后续能单独合作，微信主动转了 8k 给我，然后给他恢复了系统，并且他要了一份源码。\r\n\r\n事情到此圆满收场，负责人用了 8k 顺利接下了公司的系统，我也拿全了我的开发费用，双赢，小丑竟是他自己。。。","content_rendered":"<p>原帖<a href=\"/t/843509\" rel=\"nofollow\">/t/843509</a></p>\n<p>4 月初，一直毫无动静，感觉情况不对，从其他被开的员工那里打听到，由于年前大量扩张，老系统被卡脖子（用的是第三方的，所以才找我开发新的），加上年后 YQ （主要靠招商加盟）没有开单，公司已经分崩离析，大量开人，本来就干不下去了想转行，现在正好以此为接口，对代理商宣称系统被黑，全停了（不得谢谢我）</p>\n<p>清明期间，项目负责人一直联系我见面，说能给钱，他能决定。见面后确认公司情况属实，几个股东已撤，现在就是拖着，他也抱怨那个老板，表示想单干，目前还在公司有利可图，并且手里有 200+代理商，希望后续能单独合作，微信主动转了 8k 给我，然后给他恢复了系统，并且他要了一份源码。</p>\n<p>事情到此圆满收场，负责人用了 8k 顺利接下了公司的系统，我也拿全了我的开发费用，双赢，小丑竟是他自己。。。</p>\n","last_modified":1649211412,"replies":10,"id":845147},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1648813467","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1648813467","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":48125,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1648813467","stars":7765,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"id":569601,"username":"redtech","url":"https://www.v2ex.com/u/redtech","website":"","twitter":"","psn":"","github":"byoungd","btc":"","location":"","tagline":"","bio":"性别男！","avatar_mini":"https://cdn.v2ex.com/avatar/e686/1954/569601_mini.png?m=1644995865","avatar_normal":"https://cdn.v2ex.com/avatar/e686/1954/569601_normal.png?m=1644995865","avatar_large":"https://cdn.v2ex.com/avatar/e686/1954/569601_large.png?m=1644995865","avatar_xlarge":"https://cdn.v2ex.com/avatar/e686/1954/569601_xlarge.png?m=1644995865","avatar_xxlarge":"https://cdn.v2ex.com/avatar/e686/1954/569601_xlarge.png?m=1644995865","avatar_xxxlarge":"https://cdn.v2ex.com/avatar/e686/1954/569601_xlarge.png?m=1644995865","created":1642644977,"last_modified":1644995865},"last_reply_by":"redtech","last_touched":1649216718,"title":"前端项目 如何进行目标管理 如何在计划的时间内完成任务","url":"https://www.v2ex.com/t/845163","created":1649213726,"deleted":0,"content":"# 背景介绍\r\n\r\n目前我司前端项目里有一个大的模块正在实现，先简单的说一下我们的研发流程：\r\n\r\n- 项目经理和产品经理确定需求 给出原型和需求文档\r\n\r\n- 前端开始技术评审 确定实现方案\r\n\r\n- 该模块的参与人员进行任务评估 \r\n\r\n- 开发人员进行最小可行性测试验证 设计师同步进行 UI 设计\r\n\r\n- 开发任务录入到任务管理工具 并分配到具体的执行者\r\n\r\n- 小的任务开发完会转测 \r\n\r\n- 开发到一定阶段代码进行合并 将不同分支的功能合并至开发分支\r\n\r\n- 预发布时线上灰度测试\r\n\r\n- 测试那边进行详尽的测试 认为达到预期则准备合并到发布分支准备发布\r\n\r\n\r\n## 目前遇到的问题\r\n\r\n- 开发人员无法准确评估时间 我们是开发人员先自行评估时间 项目经理批复后确定任务周期\r\n\r\n- 任务经常严重逾期\r\n\r\n\r\n## 该任务参与人员规模\r\n\r\n- 设计师 2\r\n- 前端开发 5\r\n- 项目经理 1\r\n- 产品经理 1\r\n- 后端 2\r\n- 测试 2\r\n\r\n\r\n## 诉求\r\n\r\n参考更高效的目标管理模式，争取改善当前的局面","content_rendered":"<h1>背景介绍</h1>\n<p>目前我司前端项目里有一个大的模块正在实现，先简单的说一下我们的研发流程：</p>\n<ul>\n<li>\n<p>项目经理和产品经理确定需求 给出原型和需求文档</p>\n</li>\n<li>\n<p>前端开始技术评审 确定实现方案</p>\n</li>\n<li>\n<p>该模块的参与人员进行任务评估 </p>\n</li>\n<li>\n<p>开发人员进行最小可行性测试验证 设计师同步进行 UI 设计</p>\n</li>\n<li>\n<p>开发任务录入到任务管理工具 并分配到具体的执行者</p>\n</li>\n<li>\n<p>小的任务开发完会转测 </p>\n</li>\n<li>\n<p>开发到一定阶段代码进行合并 将不同分支的功能合并至开发分支</p>\n</li>\n<li>\n<p>预发布时线上灰度测试</p>\n</li>\n<li>\n<p>测试那边进行详尽的测试 认为达到预期则准备合并到发布分支准备发布</p>\n</li>\n</ul>\n<h2>目前遇到的问题</h2>\n<ul>\n<li>\n<p>开发人员无法准确评估时间 我们是开发人员先自行评估时间 项目经理批复后确定任务周期</p>\n</li>\n<li>\n<p>任务经常严重逾期</p>\n</li>\n</ul>\n<h2>该任务参与人员规模</h2>\n<ul>\n<li>设计师 2</li>\n<li>前端开发 5</li>\n<li>项目经理 1</li>\n<li>产品经理 1</li>\n<li>后端 2</li>\n<li>测试 2</li>\n</ul>\n<h2>诉求</h2>\n<p>参考更高效的目标管理模式，争取改善当前的局面</p>\n","last_modified":1649213726,"replies":9,"id":845163},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_large.png?m=1630643913","name":"apple","avatar_normal":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_normal.png?m=1630643913","title":"Apple","url":"https://www.v2ex.com/go/apple","topics":18047,"footer":"","header":"设计了 <a href=\"/go/watch\">Apple Watch</a>，<a href=\"/go/ipad\">iPad</a>，<a href=\"/go/iphone\">iPhone</a>，<a href=\"/go/imac\">iMac</a> 及 <a href=\"/go/mbp\">MacBook Pro</a> 等电子产品的美国公司。","title_alternative":"Apple","avatar_mini":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_mini.png?m=1630643913","stars":2119,"aliases":[],"root":false,"id":184,"parent_node_name":"hardware"},"member":{"id":373557,"username":"dier","url":"https://www.v2ex.com/u/dier","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/b586/3b49/373557_mini.png?m=1556000592","avatar_normal":"https://cdn.v2ex.com/avatar/b586/3b49/373557_normal.png?m=1556000592","avatar_large":"https://cdn.v2ex.com/avatar/b586/3b49/373557_large.png?m=1556000592","created":1545964932,"last_modified":1556000592},"last_reply_by":"dier","last_touched":1649214072,"title":"AirPods 成 Air 了","url":"https://www.v2ex.com/t/845142","created":1649210278,"deleted":0,"content":"放假出去郊游，估计是外套脱了几回掉了野外了，第二天才想起来。发现找不到了。。。","content_rendered":"<p>放假出去郊游，估计是外套脱了几回掉了野外了，第二天才想起来。发现找不到了。。。</p>\n","last_modified":1649210278,"replies":8,"id":845142},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/70ef/df2e/17_large.png?m=1647187757","name":"create","avatar_normal":"https://cdn.v2ex.com/navatar/70ef/df2e/17_normal.png?m=1647187757","title":"分享创造","url":"https://www.v2ex.com/go/create","topics":17577,"footer":"","header":"欢迎你在这里发布自己的最新作品！","title_alternative":"Create","avatar_mini":"https://cdn.v2ex.com/navatar/70ef/df2e/17_mini.png?m=1647187757","stars":4250,"aliases":[],"root":false,"id":17,"parent_node_name":"geek"},"member":{"id":508556,"username":"dongfuye1","url":"https://www.v2ex.com/u/dongfuye1","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/c7df/9847/508556_mini.png?m=1649207538","avatar_normal":"https://cdn.v2ex.com/avatar/c7df/9847/508556_normal.png?m=1649207538","avatar_large":"https://cdn.v2ex.com/avatar/c7df/9847/508556_large.png?m=1649207538","created":1600332548,"last_modified":1649207538},"last_reply_by":"swulling","last_touched":1649215344,"title":"消息最终一致性的架构革命","url":"https://www.v2ex.com/t/845132","created":1649208547,"deleted":0,"content":"## 概述\r\n跨服务更新数据是应用开发常见的任务，如果一些关键数据对一致性的要求较高，而业务上也不需要支持回滚的话，那么通常就会采用本地消息表的方式来保证最终一致。许多公司在处理跨服务更新数据一致性问题时，都会先引入本地消息表，后续随着业务场景复杂化，再引入更多的事务模式\r\n\r\n本文提出的二阶消息，是一种新模式，新架构，优雅的解决了消息最终一致性的问题。解决同样的一个问题，可以将本地消息表或者事务消息中，上百行的代码简化为大约五六行，大大简化了架构，提升开发效率，具备非常大的优势。\r\n\r\n下面我们以跨行转账作为例子，给大家详解这种新架构。业务场景介绍如下：\r\n\r\n我们需要跨行从 A 转给 B 30 元，我们先进行可能失败的转出操作 TransOut ，即进行 A 扣减 30 元。如果 A 因余额不足扣减失败，那么转账直接失败，返回错误；如果扣减成功，那么进行下一步转入操作，因为转入操作没有余额不足的问题，可以假定转入操作一定会成功。\r\n\r\n## 采用新架构开发\r\n新架构基于分布式事务管理器 [dtm-labs/dtm]( https://github.com/dtm-labs/dtm)\r\n\r\n完成上述任务的核心代码如下所示：\r\n\r\n``` Go\r\nmsg := dtmcli.NewMsg(DtmServer, gid).\r\n\tAdd(busi.Busi+\"/TransIn\", &TransReq{Amount: 30})\r\nerr := msg.DoAndSubmitDB(busi.Busi+\"/QueryPreparedB\", db, func(tx *sql.Tx) error {\r\n\treturn busi.SagaAdjustBalance(tx, busi.TransOutUID, -req.Amount, \"SUCCESS\")\r\n})\r\n```\r\n\r\n\r\n> 上述代码是 HTTP 接入，gRPC 的接入和 HTTP 基本一样，这里不再赘述，有需要的读者，可以参考[dtm-labs/dtm-examples]( https://github.com/dtm-labs/dtm-examples)中的例子\r\n\r\n\r\n这部分代码中\r\n- 首先生成一个 DTM 的 msg 全局事务，传递 dtm 的服务器地址和全局事务 id\r\n- 给 msg 添加一个分支业务逻辑，这里的业务逻辑为余额转入操作 TransIn ，然后带上这个服务需要传递的数据，金额 30 元\r\n- 然后调用 msg 的 DoAndSubmitDB ，这个函数保证业务成功执行和 msg 全局事务提交，要么同时成功，要么同时失败\r\n\t1. 第一个参数为回查 URL ，详细含义稍后说\r\n\t2. 第二个参数为 sql.DB ，是业务访问的数据库对象\r\n\t3. 第三个参数是业务函数，我们这个例子中的业务是给 A 扣减 30 元余额\r\n\r\n由于当前 TransOut 业务操作与 TransIn 不再同一个服务，因此可能发生执行完一个操作后，发生进程 crash ，导致另一个操作未执行，此时 dtm 会通过回查 URL ，查询 TransOut 的业务操作是否成功完成。dtm 里面的回查只需要粘贴如下代码即可，框架会自动完成回查逻辑：\r\n\r\n``` go\r\napp.GET(BusiAPI+\"/QueryPreparedB\", dtmutil.WrapHandler2(func(c *gin.Context) interface{} {\r\n    return MustBarrierFromGin(c).QueryPrepared(dbGet())\r\n}))\r\n```\r\n至此一个完整的二阶段消息的业务完成，接入复杂度、代码量比本地消息表等现有方案，都有巨大的优势，已成为这类问题的首选方案。您可以通过以下命令运行一个完整的例子：\r\n\r\n#### 运行 dtm\r\n``` bash\r\ngit clone https://github.com/dtm-labs/dtm && cd dtm\r\ngo run main.go\r\n```\r\n#### 运行例子\r\n```\r\ngit clone https://github.com/dtm-labs/dtm-examples && cd dtm-examples \r\ngo run main.go http_msg_doAndCommit\r\n```\r\n\r\n## 成功流程\r\nDoAndSubmitDB 是如何保证业务成功执行与 msg 提交的原子性的呢？请看如下的时序图：\r\n![image.png]( https://pic2.zhimg.com/80/v2-96a053d3a308443c86bc812dc0d1dc61_1440w.jpg)\r\n\r\n一般情况下，时序图中的 5 个步骤会正常完成，整个业务按照预期进行，全局事务完成。这里面有个新的内容需要解释一下，就是 msg 的提交是按照两个阶段发起的，第一阶段调用 Prepare ，第二阶段调用 Commit ，DTM 收到 Prepare 调用后，不会调用分支事务，而是等待后续的 Submit 。只有收到了 Submit ，开始分支调用，最终完成全局事务。\r\n\r\n## 提交后宕机流程\r\n在分布式系统中，各类的宕机和网络异常都是需要考虑的，下面我们来看看可能发生的问题：\r\n\r\n首先我们要达到的最重要目标是业务成功执行和 msg 事务是原子操作，因此首先看如果在业务完成提交后，发送 Submit 消息前出现了宕机故障会怎么样，新架构如何保证原子性？\r\n\r\n我们来看看这种情况下的时序图：\r\n\r\n![image.png]( https://pic3.zhimg.com/80/v2-b700e88f890174237a92801a1c92d752_1440w.jpg)\r\n\r\n如果在本地事务提交之后，在发送 Submit 前，出现了进程 Crash 或者机器宕机会怎么样？这个时候 DTM 会在一定超时时间之后，取出只 Prepare 但未 Submit 的 msg 事务，调用 msg 事务指定的回查服务。\r\n\r\n您的回查服务逻辑，不需要手动编写，只需要按照之前给出的代码进行调用即可，它会到表里面查询，本地事务是否提交了：\r\n\r\n- **已提交：** 返回成功，dtm 进行下一步子事务调用\r\n- **已回滚：** 返回失败，dtm 终止全局事务，不再进行子事务调用\r\n- **进行中：** 这个回查会等待最终结果，然后按照前面的已提交 /已回滚的情况处理\r\n\r\n## 提交前宕机流程\r\n我们来看看本地事务被回滚的时序图：\r\n![image.png]( https://pic3.zhimg.com/80/v2-7a868fe2089da356c02643dd0001e4ea_1440w.jpg)\r\n\r\n如果在 dtm 收到 Prepare 调用后，AP 在事务提交前，遇见故障宕机，那么数据库会检测到 AP 的连接断开，自动回滚本地事务。\r\n\r\n后续 dtm 轮询取出已经超时的，只 Prepare 但没有 Submit 的全局事务，进行回查。回查服务发现本地事务已回滚，返回结果给 dtm 。dtm 收到已回滚的结果后，将全局事务标记为失败，并结束该全局事务。\r\n\r\n## 易用性\r\n采用新架构处理一致性问题，仅需要：\r\n- 定义好本地业务逻辑，指定下一步处理的服务即可\r\n- 定义 QueryPrepared 处理服务，复制粘贴例子代码即可。\r\n\r\n然后我们看看其他方案情况\r\n## 二阶消息 vs 本地消息表\r\n上述的问题也可以采用本地消息表方案（方案详情参考[分布式事务最经典的七种解决方案]( https://segmentfault.com/a/1190000040321750)），来保证数据的最终一致性。如果采用本地消息表，需要的工作包括：\r\n- 在本地事务中执行本地业务逻辑，将消息插入消息表并最后提交\r\n- 编写轮询任务，将本地消息表的消息，发给消息队列\r\n- 消费消息，并将消息发给相应的处理服务\r\n\r\n两者对比，二阶消息有以下优点：\r\n- 无需学习或维护任何消息队列\r\n- 不需要处理轮询任务\r\n- 不需要消费消息\r\n\r\n## 二阶消息 vs 事务消息\r\n上述的问题也可以采用 RocketMQ 的事务消息方案（方案详情参考[分布式事务最经典的七种解决方案]( https://segmentfault.com/a/1190000040321750)），来保证数据的最终一致性。如果采用本地消息表，需要的工作包括：\r\n\r\n如果采用事务消息，需要的工作包括：\r\n- 开启本地事务，发送半消息，提交事务，发送 commit 消息\r\n- 消费超时的半消息，对于收到的超时半消息，查询本地数据库，然后进行 Commit/Rollback\r\n- 消费已提交的消息，并将消息发送给处理服务\r\n\r\n两者对比，二阶消息有以下优点：\r\n- 无需学习或维护任何消息队列\r\n- 本地事务与发送消息之间的复杂操作需要手动处理，一不小心，可能出现 bug 。而二阶消息则是全自动处理\r\n- 不需要消费消息\r\n\r\n二阶消息在二阶段提交方面，与 RocketMQ 的事务消息相似，是受到 RocketMQ 的事务消息启发后提出的新架构。二阶消息的命名，不再复用 RocketMQ 的事务消息，主要是因为二阶消息在架构上有很大的改变，而另一方面，在分布式事务的上下文中，使用”事务消息“这个名字，容易带来理解上的混淆。\r\n\r\n## 更多的优点\r\n对比于前面讲述的队列方案，二阶消息还有很多额外的优点：\r\n- 二阶消息整个暴露的接口，完全与队列无关，只跟实际的业务和服务调用相关，对开发人员更加友好\r\n- 二阶消息不用考虑消息队列消息堆积及其他故障等问题，因为二阶消息只依赖 dtm ，开发人员可以认为 dtm 与系统中其他一个普通无状态服务一样，只依赖背后的存储 Mysql/Redis 。\r\n- 消息队列是异步的，而二阶消息同时支持异步和同步，默认异步，只需要打开 msg.WaitResult=true ，那么可以同步等待下游服务完成\r\n- 二阶消息还支持同时指定多个下游服务\r\n\r\n#### 二阶消息未来展望\r\n二阶消息能够大幅降低消息最终一致性解决方案的难度，获得广泛的应用。未来 dtm 会考虑添加后台，允许动态指定下游服务，提供更高的灵活性。如果您原先采用消息队列来做服务解耦，那么这个 dtm 的后台，允许你直接指定某个消息的多个接收函数，无需编写消息消费者，带来更加简单、直观、易用的开发体验。\r\n\r\n## 回查原理剖析\r\n前面的时序图中，以及接口中都出现了回查服务，在二阶消息中，是复制粘贴代码自动处理的，而 RocketMQ 的事务消息，则是手动处理的。那么自动处理的原理是什么？\r\n\r\n要进行回查，首先要在业务数据库实例中，建立一张独立的表，里面保存全局事务 id 。在处理业务事务时，会把 gid 写入到这张表。\r\n\r\n当我们用 gid 回查时，如果能够在表中查到 gid ，那么说明本地事务已提交，这样就可以返回 dtm ，告知本地事务已提交。\r\n\r\n当我们用 gid 回查时，没有在表中查到 gid ，那么说明本地事务未提交，此时可能的结果是两个，一是事务还在进行中，二是事务已回滚。我查了许多关于 RocketMQ 的资料，未找到有效的解决方案。搜到所有解决方案是，如果未查到结果，那么什么都不做，等待下一次回查，如果 2 分钟或者更久的回查，一直都是查不到的，那么认为本地事务已回滚。\r\n\r\n上述这种方案有很大的问题：\r\n- 两分钟还查不到 gid ，并不能认为本地事务已回滚，极端情况下，可能发生数据库故障（例如进程或磁盘卡住了），持续时间超过 2 分钟，最后数据又提交了，那么这个时候，数据就不是最终一致了，就需要人工介入处理了\r\n- 如果一个本地事务，已经回滚了，但是回查操作，还会在两分钟之内，按照 10s 左右的时间间隔，不断的进行轮询，会给服务器造成不必要的压力\r\n\r\n而 dtm 的二阶消息方案，则彻底解决了这部分的问题。dtm 的二阶消息工作过程如下：\r\n\r\n1. 在处理本地事务时，会将 gid 插入到 dtm_barrier.barrier 表中，同时带上插入原因为 committed 。该表有一个唯一索引，主要字段为 gid 。\r\n2. 当进行回查时，二阶消息的操作不是直接查 gid 是否存在，而是再 insert ignore 一条带有相同 gid 的数据，同时带上插入原因为 rollbacked 。此时如果表中如果已有 gid 的记录，那么新的插入操作就会被 ignore ，否则数据会被插入。\r\n3. 然后再用 gid 查询表中的记录，如果查到记录的 reason 为 committed ，那么说明本地事务已提交；如果查到记录的 reason 为 rollbacked ，那么说明本地事务已回滚。\r\n\r\n那么对比 RocketMQ 回查时的常见方案，二阶消息是如何区分出进行中和已回滚呢？其中的技巧在于回查时插入的数据，如果回查时，数据库的事务还在进行中，那么插入操作就会被进行中的事务阻塞，因为插入操作会等待事务中持有的锁。如果插入操作正常返回，那么数据库中的本地事务，必定已结束，必然是已提交或已回滚。\r\n\r\n下面给大家留一个问题：二阶消息的操作 3 能否省略，能否只根据步骤 2 的插入是否成功，来判断是否已回滚？欢迎大家留言讨论\r\n\r\n## 普通消息\r\n二阶消息不仅可以替换本地消息表方案，也能够替换普通消息方案。如果直接调用 Submit ，那么就与普通消息方案近似，但是提供了更灵活简单的接口。\r\n\r\n假设一个这样的应用场景，界面上有一个参加活动的按钮，如果参加活动，会赠与两本电子书的永久权限。这种情况下，可以再这个按钮的服务端中，类似这样处理：\r\n```\r\nmsg := dtmcli.NewMsg(DtmServer, gid).\r\n\tAdd(busi.Busi+\"/AuthBook\", &Req{UID: 1, BookID: 5}).\r\n\tAdd(busi.Busi+\"/AuthBook\", &Req{UID: 1, BookID: 6})\r\nerr := msg.Submit()\r\n```\r\n\r\n这种方式也提供了异步接口，而不用依赖消息消息队列。在微服务的许多场景中，可以替换原有的异步消息架构。\r\n\r\n## 小结\r\n本文提出的二阶消息，接口简洁优雅，带来了比本地消息表和 Rocket 事务消息更简单的架构，可以帮助大家更好的解决无需回滚的数据一致性问题。\r\n\r\n## 项目地址\r\n\r\n关于分布式事务更多的理论知识与实践，可以访问以下项目和公众号：\r\n\r\n[https://github.com/dtm-labs/dtm]( https://github.com/dtm-labs/dtm) ，欢迎访问，并 star 支持我们。\r\n\r\n关注 [分布式事务] 公众号，获取更多分布式事务相关知识，同时可以加入我们的社群","content_rendered":"<h2>概述</h2>\n<p>跨服务更新数据是应用开发常见的任务，如果一些关键数据对一致性的要求较高，而业务上也不需要支持回滚的话，那么通常就会采用本地消息表的方式来保证最终一致。许多公司在处理跨服务更新数据一致性问题时，都会先引入本地消息表，后续随着业务场景复杂化，再引入更多的事务模式</p>\n<p>本文提出的二阶消息，是一种新模式，新架构，优雅的解决了消息最终一致性的问题。解决同样的一个问题，可以将本地消息表或者事务消息中，上百行的代码简化为大约五六行，大大简化了架构，提升开发效率，具备非常大的优势。</p>\n<p>下面我们以跨行转账作为例子，给大家详解这种新架构。业务场景介绍如下：</p>\n<p>我们需要跨行从 A 转给 B 30 元，我们先进行可能失败的转出操作 TransOut ，即进行 A 扣减 30 元。如果 A 因余额不足扣减失败，那么转账直接失败，返回错误；如果扣减成功，那么进行下一步转入操作，因为转入操作没有余额不足的问题，可以假定转入操作一定会成功。</p>\n<h2>采用新架构开发</h2>\n<p>新架构基于分布式事务管理器 <a href=\"https://github.com/dtm-labs/dtm\" rel=\"nofollow\">dtm-labs/dtm</a></p>\n<p>完成上述任务的核心代码如下所示：</p>\n<pre><code class=\"language-Go\">msg := dtmcli.NewMsg(DtmServer, gid).\n\tAdd(busi.Busi+\"/TransIn\", &amp;TransReq{Amount: 30})\nerr := msg.DoAndSubmitDB(busi.Busi+\"/QueryPreparedB\", db, func(tx *sql.Tx) error {\n\treturn busi.SagaAdjustBalance(tx, busi.TransOutUID, -req.Amount, \"SUCCESS\")\n})\n</code></pre>\n<blockquote>\n<p>上述代码是 HTTP 接入，gRPC 的接入和 HTTP 基本一样，这里不再赘述，有需要的读者，可以参考<a href=\"https://github.com/dtm-labs/dtm-examples\" rel=\"nofollow\">dtm-labs/dtm-examples</a>中的例子</p>\n</blockquote>\n<p>这部分代码中</p>\n<ul>\n<li>首先生成一个 DTM 的 msg 全局事务，传递 dtm 的服务器地址和全局事务 id</li>\n<li>给 msg 添加一个分支业务逻辑，这里的业务逻辑为余额转入操作 TransIn ，然后带上这个服务需要传递的数据，金额 30 元</li>\n<li>\n然后调用 msg 的 DoAndSubmitDB ，这个函数保证业务成功执行和 msg 全局事务提交，要么同时成功，要么同时失败<ol>\n<li>第一个参数为回查 URL ，详细含义稍后说</li>\n<li>第二个参数为 sql.DB ，是业务访问的数据库对象</li>\n<li>第三个参数是业务函数，我们这个例子中的业务是给 A 扣减 30 元余额</li>\n</ol>\n</li>\n</ul>\n<p>由于当前 TransOut 业务操作与 TransIn 不再同一个服务，因此可能发生执行完一个操作后，发生进程 crash ，导致另一个操作未执行，此时 dtm 会通过回查 URL ，查询 TransOut 的业务操作是否成功完成。dtm 里面的回查只需要粘贴如下代码即可，框架会自动完成回查逻辑：</p>\n<pre><code class=\"language-go\">app.GET(BusiAPI+\"/QueryPreparedB\", dtmutil.WrapHandler2(func(c *gin.Context) interface{} {\n    return MustBarrierFromGin(c).QueryPrepared(dbGet())\n}))\n</code></pre>\n<p>至此一个完整的二阶段消息的业务完成，接入复杂度、代码量比本地消息表等现有方案，都有巨大的优势，已成为这类问题的首选方案。您可以通过以下命令运行一个完整的例子：</p>\n<h4>运行 dtm</h4>\n<pre><code class=\"language-bash\">git clone https://github.com/dtm-labs/dtm &amp;&amp; cd dtm\ngo run main.go\n</code></pre>\n<h4>运行例子</h4>\n<pre><code>git clone https://github.com/dtm-labs/dtm-examples &amp;&amp; cd dtm-examples \ngo run main.go http_msg_doAndCommit\n</code></pre>\n<h2>成功流程</h2>\n<p>DoAndSubmitDB 是如何保证业务成功执行与 msg 提交的原子性的呢？请看如下的时序图：\n<img alt=\"image.png\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://pic2.zhimg.com/80/v2-96a053d3a308443c86bc812dc0d1dc61_1440w.jpg\"/></p>\n<p>一般情况下，时序图中的 5 个步骤会正常完成，整个业务按照预期进行，全局事务完成。这里面有个新的内容需要解释一下，就是 msg 的提交是按照两个阶段发起的，第一阶段调用 Prepare ，第二阶段调用 Commit ，DTM 收到 Prepare 调用后，不会调用分支事务，而是等待后续的 Submit 。只有收到了 Submit ，开始分支调用，最终完成全局事务。</p>\n<h2>提交后宕机流程</h2>\n<p>在分布式系统中，各类的宕机和网络异常都是需要考虑的，下面我们来看看可能发生的问题：</p>\n<p>首先我们要达到的最重要目标是业务成功执行和 msg 事务是原子操作，因此首先看如果在业务完成提交后，发送 Submit 消息前出现了宕机故障会怎么样，新架构如何保证原子性？</p>\n<p>我们来看看这种情况下的时序图：</p>\n<p><img alt=\"image.png\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://pic3.zhimg.com/80/v2-b700e88f890174237a92801a1c92d752_1440w.jpg\"/></p>\n<p>如果在本地事务提交之后，在发送 Submit 前，出现了进程 Crash 或者机器宕机会怎么样？这个时候 DTM 会在一定超时时间之后，取出只 Prepare 但未 Submit 的 msg 事务，调用 msg 事务指定的回查服务。</p>\n<p>您的回查服务逻辑，不需要手动编写，只需要按照之前给出的代码进行调用即可，它会到表里面查询，本地事务是否提交了：</p>\n<ul>\n<li><strong>已提交：</strong> 返回成功，dtm 进行下一步子事务调用</li>\n<li><strong>已回滚：</strong> 返回失败，dtm 终止全局事务，不再进行子事务调用</li>\n<li><strong>进行中：</strong> 这个回查会等待最终结果，然后按照前面的已提交 /已回滚的情况处理</li>\n</ul>\n<h2>提交前宕机流程</h2>\n<p>我们来看看本地事务被回滚的时序图：\n<img alt=\"image.png\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://pic3.zhimg.com/80/v2-7a868fe2089da356c02643dd0001e4ea_1440w.jpg\"/></p>\n<p>如果在 dtm 收到 Prepare 调用后，AP 在事务提交前，遇见故障宕机，那么数据库会检测到 AP 的连接断开，自动回滚本地事务。</p>\n<p>后续 dtm 轮询取出已经超时的，只 Prepare 但没有 Submit 的全局事务，进行回查。回查服务发现本地事务已回滚，返回结果给 dtm 。dtm 收到已回滚的结果后，将全局事务标记为失败，并结束该全局事务。</p>\n<h2>易用性</h2>\n<p>采用新架构处理一致性问题，仅需要：</p>\n<ul>\n<li>定义好本地业务逻辑，指定下一步处理的服务即可</li>\n<li>定义 QueryPrepared 处理服务，复制粘贴例子代码即可。</li>\n</ul>\n<p>然后我们看看其他方案情况</p>\n<h2>二阶消息 vs 本地消息表</h2>\n<p>上述的问题也可以采用本地消息表方案（方案详情参考<a href=\"https://segmentfault.com/a/1190000040321750\" rel=\"nofollow\">分布式事务最经典的七种解决方案</a>），来保证数据的最终一致性。如果采用本地消息表，需要的工作包括：</p>\n<ul>\n<li>在本地事务中执行本地业务逻辑，将消息插入消息表并最后提交</li>\n<li>编写轮询任务，将本地消息表的消息，发给消息队列</li>\n<li>消费消息，并将消息发给相应的处理服务</li>\n</ul>\n<p>两者对比，二阶消息有以下优点：</p>\n<ul>\n<li>无需学习或维护任何消息队列</li>\n<li>不需要处理轮询任务</li>\n<li>不需要消费消息</li>\n</ul>\n<h2>二阶消息 vs 事务消息</h2>\n<p>上述的问题也可以采用 RocketMQ 的事务消息方案（方案详情参考<a href=\"https://segmentfault.com/a/1190000040321750\" rel=\"nofollow\">分布式事务最经典的七种解决方案</a>），来保证数据的最终一致性。如果采用本地消息表，需要的工作包括：</p>\n<p>如果采用事务消息，需要的工作包括：</p>\n<ul>\n<li>开启本地事务，发送半消息，提交事务，发送 commit 消息</li>\n<li>消费超时的半消息，对于收到的超时半消息，查询本地数据库，然后进行 Commit/Rollback</li>\n<li>消费已提交的消息，并将消息发送给处理服务</li>\n</ul>\n<p>两者对比，二阶消息有以下优点：</p>\n<ul>\n<li>无需学习或维护任何消息队列</li>\n<li>本地事务与发送消息之间的复杂操作需要手动处理，一不小心，可能出现 bug 。而二阶消息则是全自动处理</li>\n<li>不需要消费消息</li>\n</ul>\n<p>二阶消息在二阶段提交方面，与 RocketMQ 的事务消息相似，是受到 RocketMQ 的事务消息启发后提出的新架构。二阶消息的命名，不再复用 RocketMQ 的事务消息，主要是因为二阶消息在架构上有很大的改变，而另一方面，在分布式事务的上下文中，使用”事务消息“这个名字，容易带来理解上的混淆。</p>\n<h2>更多的优点</h2>\n<p>对比于前面讲述的队列方案，二阶消息还有很多额外的优点：</p>\n<ul>\n<li>二阶消息整个暴露的接口，完全与队列无关，只跟实际的业务和服务调用相关，对开发人员更加友好</li>\n<li>二阶消息不用考虑消息队列消息堆积及其他故障等问题，因为二阶消息只依赖 dtm ，开发人员可以认为 dtm 与系统中其他一个普通无状态服务一样，只依赖背后的存储 Mysql/Redis 。</li>\n<li>消息队列是异步的，而二阶消息同时支持异步和同步，默认异步，只需要打开 msg.WaitResult=true ，那么可以同步等待下游服务完成</li>\n<li>二阶消息还支持同时指定多个下游服务</li>\n</ul>\n<h4>二阶消息未来展望</h4>\n<p>二阶消息能够大幅降低消息最终一致性解决方案的难度，获得广泛的应用。未来 dtm 会考虑添加后台，允许动态指定下游服务，提供更高的灵活性。如果您原先采用消息队列来做服务解耦，那么这个 dtm 的后台，允许你直接指定某个消息的多个接收函数，无需编写消息消费者，带来更加简单、直观、易用的开发体验。</p>\n<h2>回查原理剖析</h2>\n<p>前面的时序图中，以及接口中都出现了回查服务，在二阶消息中，是复制粘贴代码自动处理的，而 RocketMQ 的事务消息，则是手动处理的。那么自动处理的原理是什么？</p>\n<p>要进行回查，首先要在业务数据库实例中，建立一张独立的表，里面保存全局事务 id 。在处理业务事务时，会把 gid 写入到这张表。</p>\n<p>当我们用 gid 回查时，如果能够在表中查到 gid ，那么说明本地事务已提交，这样就可以返回 dtm ，告知本地事务已提交。</p>\n<p>当我们用 gid 回查时，没有在表中查到 gid ，那么说明本地事务未提交，此时可能的结果是两个，一是事务还在进行中，二是事务已回滚。我查了许多关于 RocketMQ 的资料，未找到有效的解决方案。搜到所有解决方案是，如果未查到结果，那么什么都不做，等待下一次回查，如果 2 分钟或者更久的回查，一直都是查不到的，那么认为本地事务已回滚。</p>\n<p>上述这种方案有很大的问题：</p>\n<ul>\n<li>两分钟还查不到 gid ，并不能认为本地事务已回滚，极端情况下，可能发生数据库故障（例如进程或磁盘卡住了），持续时间超过 2 分钟，最后数据又提交了，那么这个时候，数据就不是最终一致了，就需要人工介入处理了</li>\n<li>如果一个本地事务，已经回滚了，但是回查操作，还会在两分钟之内，按照 10s 左右的时间间隔，不断的进行轮询，会给服务器造成不必要的压力</li>\n</ul>\n<p>而 dtm 的二阶消息方案，则彻底解决了这部分的问题。dtm 的二阶消息工作过程如下：</p>\n<ol>\n<li>在处理本地事务时，会将 gid 插入到 dtm_barrier.barrier 表中，同时带上插入原因为 committed 。该表有一个唯一索引，主要字段为 gid 。</li>\n<li>当进行回查时，二阶消息的操作不是直接查 gid 是否存在，而是再 insert ignore 一条带有相同 gid 的数据，同时带上插入原因为 rollbacked 。此时如果表中如果已有 gid 的记录，那么新的插入操作就会被 ignore ，否则数据会被插入。</li>\n<li>然后再用 gid 查询表中的记录，如果查到记录的 reason 为 committed ，那么说明本地事务已提交；如果查到记录的 reason 为 rollbacked ，那么说明本地事务已回滚。</li>\n</ol>\n<p>那么对比 RocketMQ 回查时的常见方案，二阶消息是如何区分出进行中和已回滚呢？其中的技巧在于回查时插入的数据，如果回查时，数据库的事务还在进行中，那么插入操作就会被进行中的事务阻塞，因为插入操作会等待事务中持有的锁。如果插入操作正常返回，那么数据库中的本地事务，必定已结束，必然是已提交或已回滚。</p>\n<p>下面给大家留一个问题：二阶消息的操作 3 能否省略，能否只根据步骤 2 的插入是否成功，来判断是否已回滚？欢迎大家留言讨论</p>\n<h2>普通消息</h2>\n<p>二阶消息不仅可以替换本地消息表方案，也能够替换普通消息方案。如果直接调用 Submit ，那么就与普通消息方案近似，但是提供了更灵活简单的接口。</p>\n<p>假设一个这样的应用场景，界面上有一个参加活动的按钮，如果参加活动，会赠与两本电子书的永久权限。这种情况下，可以再这个按钮的服务端中，类似这样处理：</p>\n<pre><code>msg := dtmcli.NewMsg(DtmServer, gid).\n\tAdd(busi.Busi+\"/AuthBook\", &amp;Req{UID: 1, BookID: 5}).\n\tAdd(busi.Busi+\"/AuthBook\", &amp;Req{UID: 1, BookID: 6})\nerr := msg.Submit()\n</code></pre>\n<p>这种方式也提供了异步接口，而不用依赖消息消息队列。在微服务的许多场景中，可以替换原有的异步消息架构。</p>\n<h2>小结</h2>\n<p>本文提出的二阶消息，接口简洁优雅，带来了比本地消息表和 Rocket 事务消息更简单的架构，可以帮助大家更好的解决无需回滚的数据一致性问题。</p>\n<h2>项目地址</h2>\n<p>关于分布式事务更多的理论知识与实践，可以访问以下项目和公众号：</p>\n<p><a href=\"https://github.com/dtm-labs/dtm\" rel=\"nofollow\">https://github.com/dtm-labs/dtm</a> ，欢迎访问，并 star 支持我们。</p>\n<p>关注 [分布式事务] 公众号，获取更多分布式事务相关知识，同时可以加入我们的社群</p>\n","last_modified":1649208547,"replies":8,"id":845132},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1647188067","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1647188067","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":183228,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1647188067","stars":3447,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":15553,"username":"wuxqing","url":"https://www.v2ex.com/u/wuxqing","website":"http://coder.im","twitter":"wuxqing","psn":"","github":"wuxqing","btc":"","location":"","tagline":"","bio":"老码农\r\n头像是我家阿旺","avatar_mini":"https://cdn.v2ex.com/avatar/3cbf/b233/15553_mini.png?m=1450445332","avatar_normal":"https://cdn.v2ex.com/avatar/3cbf/b233/15553_normal.png?m=1450445332","avatar_large":"https://cdn.v2ex.com/avatar/3cbf/b233/15553_large.png?m=1450445332","created":1325576369,"last_modified":1450445332},"last_reply_by":"devcat","last_touched":1649217643,"title":"一直以为是脸盲，原来是心盲","url":"https://www.v2ex.com/t/845171","created":1649214551,"deleted":0,"content":"我原先一直不能回忆熟人的脸，不管多熟悉都不行，一直以为只是脸盲。\r\n\r\n现在才知道，原来是心盲症。\r\n\r\n大多数人，闭上眼睛，头脑中想象熟悉的东西，比如苹果，头脑中会出现苹果的图像的，这个被称为视觉表象。\r\n\r\n不同的人，幻想出的图像的清晰度和细节会有区别，厉害的设计师，能够在头脑中具象出复杂详细的模型，还可以进行材质的处理。一些科学家也同样可以在头脑中做“试验”。\r\n\r\n而我闭上眼睛，一片漆黑，没法具象出任何图像。原先以为这是正常的，符合直观感受，毕竟闭眼后没有光线进入眼睛。我这种其实是心盲症，大于 2-3%的人患有心盲症。绝大数是先天，少数是后天疾病导致的。\r\n\r\n这种感觉就像是我用了好久的电脑，一直都是在字符终端下工作（就像是 linux server ），某天发现大多数人都是有强大界面的（就像是 Windows 、macOS ）\r\n\r\n我能换系统吗？","content_rendered":"<p>我原先一直不能回忆熟人的脸，不管多熟悉都不行，一直以为只是脸盲。</p>\n<p>现在才知道，原来是心盲症。</p>\n<p>大多数人，闭上眼睛，头脑中想象熟悉的东西，比如苹果，头脑中会出现苹果的图像的，这个被称为视觉表象。</p>\n<p>不同的人，幻想出的图像的清晰度和细节会有区别，厉害的设计师，能够在头脑中具象出复杂详细的模型，还可以进行材质的处理。一些科学家也同样可以在头脑中做“试验”。</p>\n<p>而我闭上眼睛，一片漆黑，没法具象出任何图像。原先以为这是正常的，符合直观感受，毕竟闭眼后没有光线进入眼睛。我这种其实是心盲症，大于 2-3%的人患有心盲症。绝大数是先天，少数是后天疾病导致的。</p>\n<p>这种感觉就像是我用了好久的电脑，一直都是在字符终端下工作（就像是 linux server ），某天发现大多数人都是有强大界面的（就像是 Windows 、macOS ）</p>\n<p>我能换系统吗？</p>\n","last_modified":1649214551,"replies":7,"id":845171},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c51c/e410/13_large.png?m=1648813618","name":"idev","avatar_normal":"https://cdn.v2ex.com/navatar/c51c/e410/13_normal.png?m=1648813618","title":"iDev","url":"https://www.v2ex.com/go/idev","topics":3740,"footer":"可将讨论时涉及到的代码发布在 <a href=\"http://gist.github.com/\" target=\"_blank\">Gist</a> ，非常欢迎大家分享开发心得及讨论各种疑难问题。","header":"iOS 及 OS X 开发技术讨论区，iOS 是 <a href=\"/go/iphone\">iPhone</a> 及 <a href=\"/go/ipad\">iPad</a> 上运行的操作系统。","title_alternative":"iDev","avatar_mini":"https://cdn.v2ex.com/navatar/c51c/e410/13_mini.png?m=1648813618","stars":1473,"aliases":[],"root":false,"id":13,"parent_node_name":"dev"},"member":{"id":489819,"username":"huaweigg","url":"https://www.v2ex.com/u/huaweigg","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/a48a/5448/489819_mini.png?m=1641865998","avatar_normal":"https://cdn.v2ex.com/avatar/a48a/5448/489819_normal.png?m=1641865998","avatar_large":"https://cdn.v2ex.com/avatar/a48a/5448/489819_large.png?m=1641865998","avatar_xlarge":"https://cdn.v2ex.com/avatar/a48a/5448/489819_xlarge.png?m=1641865998","avatar_xxlarge":"https://cdn.v2ex.com/avatar/a48a/5448/489819_xlarge.png?m=1641865998","avatar_xxxlarge":"https://cdn.v2ex.com/avatar/a48a/5448/489819_xlarge.png?m=1641865998","created":1589603209,"last_modified":1641865998},"last_reply_by":"MakHoCheung","last_touched":1649216528,"title":"wwdc 2022","url":"https://www.v2ex.com/t/845148","created":1649211382,"deleted":0,"content":"https://developers.apple.com/wwdc22/\r\n\r\n依然线上，口号: call to code, 6.6 日","content_rendered":"<a target=\"_blank\" href=\"https://developers.apple.com/wwdc22/\" rel=\"nofollow noopener\">https://developers.apple.com/wwdc22/</a><br /><br />依然线上，口号: call to code, 6.6 日","last_modified":1649211410,"replies":7,"id":845148}]