[{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6e27/13a6/557_large.png?m=1608969785","name":"life","avatar_normal":"https://cdn.v2ex.com/navatar/6e27/13a6/557_normal.png?m=1608969785","title":"生活","url":"https://www.v2ex.com/go/life","topics":2917,"footer":"","header":"生活中的技术讨论","title_alternative":"Life","avatar_mini":"https://cdn.v2ex.com/navatar/6e27/13a6/557_mini.png?m=1608969785","stars":772,"aliases":[],"root":false,"id":557,"parent_node_name":""},"member":{"id":563276,"username":"ppllss","url":"https://www.v2ex.com/u/ppllss","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/556f117bf417b3a0fec61efbf5b6160e?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/556f117bf417b3a0fec61efbf5b6160e?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/556f117bf417b3a0fec61efbf5b6160e?s=73&d=retro","created":1637850193,"last_modified":1644630095},"last_reply_by":"licoycn","last_touched":1644642839,"title":"在大城市，年龄越大越发觉得孤独，该怎么缓解这种情绪。","url":"https://www.v2ex.com/t/833351","created":1644630282,"deleted":0,"content":"感觉自己很压抑，每天回去到出租房都是一个人，除了看看电影，看看直播，感觉越发觉得无趣。\r\n\r\n每当回家都一种失落感，感觉很孤独，没有人聊心里话，不知道心里出什么问题了？还是我内心不够强大？\r\n\r\n不知道兄弟们，怎么去缓解这种不良的情绪？","content_rendered":"<p>感觉自己很压抑，每天回去到出租房都是一个人，除了看看电影，看看直播，感觉越发觉得无趣。</p>\n<p>每当回家都一种失落感，感觉很孤独，没有人聊心里话，不知道心里出什么问题了？还是我内心不够强大？</p>\n<p>不知道兄弟们，怎么去缓解这种不良的情绪？</p>\n","last_modified":1644630282,"replies":39,"id":833351},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1629391393","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1629391393","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":181468,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1629391393","stars":3415,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":556900,"username":"V9NN","url":"https://www.v2ex.com/u/V9NN","website":"","twitter":null,"psn":null,"github":null,"btc":null,"location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/gravatar/ab5a7987d56e681a68ed920468ec7186?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/ab5a7987d56e681a68ed920468ec7186?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/ab5a7987d56e681a68ed920468ec7186?s=73&d=retro","created":1632620580,"last_modified":1644537985},"last_reply_by":"QGabriel","last_touched":1644643150,"title":"如何应对京东金融的频繁骚扰？","url":"https://www.v2ex.com/t/833343","created":1644625016,"deleted":0,"content":"最近京东金融平均一天打 2 次电话，完了还发短信，电话打一次变一个号，识别软件不能识别出来，这该如何是好？","content_rendered":"<p>最近京东金融平均一天打 2 次电话，完了还发短信，电话打一次变一个号，识别软件不能识别出来，这该如何是好？</p>\n","last_modified":1644625091,"replies":19,"id":833343},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/fc49/0ca4/65_large.png?m=1524891806","name":"google","avatar_normal":"https://cdn.v2ex.com/navatar/fc49/0ca4/65_normal.png?m=1524891806","title":"Google","url":"https://www.v2ex.com/go/google","topics":2751,"footer":"","header":"Google’s mission is to organize the world’s information and make it universally accessible and useful.","title_alternative":"Google","avatar_mini":"https://cdn.v2ex.com/navatar/fc49/0ca4/65_mini.png?m=1524891806","stars":3331,"aliases":[],"root":false,"id":65,"parent_node_name":"internet"},"member":{"id":265760,"username":"hongzhng","url":"https://www.v2ex.com/u/hongzhng","website":"","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/0738/98f2/265760_mini.png?m=1532333298","avatar_normal":"https://cdn.v2ex.com/avatar/0738/98f2/265760_normal.png?m=1532333298","avatar_large":"https://cdn.v2ex.com/avatar/0738/98f2/265760_large.png?m=1532333298","created":1510126581,"last_modified":1532333298},"last_reply_by":"JVMEXCEPTION","last_touched":1644642762,"title":"请问下 google drive 2t 有什么优惠的购买渠道","url":"https://www.v2ex.com/t/833348","created":1644628672,"deleted":0,"content":"想把 NAS 里的接近 2T 的文件存到 google drive 里，感觉花钱的总归会靠谱些。 看到 google one 年付一年 99 刀，可以接受，但是还想请问下除了年付，还有什么别的优惠么？ 还有就是如果 2t 用完，还有更大的空间可以购买么？ 谢谢了\r\n\r\n有自己学校的校友 gd 和 自己弄的 e5 ，但是总觉得不是花钱的不太放心放文件。:(","content_rendered":"<p>想把 NAS 里的接近 2T 的文件存到 google drive 里，感觉花钱的总归会靠谱些。 看到 google one 年付一年 99 刀，可以接受，但是还想请问下除了年付，还有什么别的优惠么？ 还有就是如果 2t 用完，还有更大的空间可以购买么？ 谢谢了</p>\n<p>有自己学校的校友 gd 和 自己弄的 e5 ，但是总觉得不是花钱的不太放心放文件。:(</p>\n","last_modified":1644628714,"replies":17,"id":833348},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/3b5d/ca50/819_large.png?m=1633251402","name":"watch","avatar_normal":"https://cdn.v2ex.com/navatar/3b5d/ca50/819_normal.png?m=1633251402","title":" WATCH","url":"https://www.v2ex.com/go/watch","topics":752,"footer":"","header":"<a href=\"/go/apple\">Apple</a> 公司设计的智能手表产品","title_alternative":" WATCH","avatar_mini":"https://cdn.v2ex.com/navatar/3b5d/ca50/819_mini.png?m=1633251402","stars":358,"aliases":[],"root":false,"id":819,"parent_node_name":"apple"},"member":{"id":495591,"username":"YoungKing6","url":"https://www.v2ex.com/u/YoungKing6","website":"","twitter":"","psn":"","github":"","btc":"","location":"","tagline":"More than","bio":"","avatar_mini":"https://cdn.v2ex.com/avatar/87ed/7214/495591_mini.png?m=1635077020","avatar_normal":"https://cdn.v2ex.com/avatar/87ed/7214/495591_normal.png?m=1635077020","avatar_large":"https://cdn.v2ex.com/avatar/87ed/7214/495591_large.png?m=1635077020","created":1592622490,"last_modified":1635077020},"last_reply_by":"codex","last_touched":1644642598,"title":"Apple Watch 有换过电池的吗？健康度 80 了","url":"https://www.v2ex.com/t/833347","created":1644627955,"deleted":0,"content":"Apple Watch Series5","content_rendered":"<p>Apple Watch Series5</p>\n","last_modified":1644640162,"replies":15,"id":833347},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1629391393","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1629391393","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":181468,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1629391393","stars":3415,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"id":434804,"username":"Zhancha","url":"https://www.v2ex.com/u/Zhancha","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/50e6/b547/434804_mini.png?m=1642565999","avatar_normal":"https://cdn.v2ex.com/avatar/50e6/b547/434804_normal.png?m=1642565999","avatar_large":"https://cdn.v2ex.com/avatar/50e6/b547/434804_large.png?m=1642565999","avatar_xlarge":"https://cdn.v2ex.com/avatar/50e6/b547/434804_xlarge.png?m=1642565999","avatar_xxlarge":"https://cdn.v2ex.com/avatar/50e6/b547/434804_xlarge.png?m=1642565999","avatar_xxxlarge":"https://cdn.v2ex.com/avatar/50e6/b547/434804_xlarge.png?m=1642565999","created":1565340792,"last_modified":1642565999},"last_reply_by":"hahasong","last_touched":1644641757,"title":"武汉购房相关问题求教。","url":"https://www.v2ex.com/t/833345","created":1644626558,"deleted":0,"content":"楼主小白一枚，是一定会在武汉上车的，时间早晚问题（ 5 年内）。\r\n\r\n工作地点在光谷，但光谷房价太高，估计可能会在白沙洲等地上车或者二手房。\r\n\r\n目前只知道在 安居客，幸福里 等平台查看房价，加中介询问，未实地考察过，也不知从何处考察起。\r\n\r\n没接触过金融地产等相关行业，不太看得懂房价走势，目前在 V 站、知乎、油管等地方获取知识。\r\n\r\n所以在此询问下大伙有关建议，关于看房买房，房价走势，二手房等问题的相关建议都可。\r\n\r\n另外如果有武汉购房群求加入。\r\n\r\n附带上在 V 站看到的比较高赞（ 50+）的相关评论：\r\n\r\n- 那些说什么刚需上车就完事的就是扯淡，身边刚有人前几个月上车的 2.2 ，现在开发商直接卖 1.8 还能送车位，你就算刚需你说等几个月入手立减几十万你不在乎？他们已经去砸售楼部跟保安群殴去了\r\n- 对于只有一套房的人来说涨了是拿不到的纸面数字，跌了是可以拿到的真金白银\r\n\r\n感谢各位的慷慨帮助！","content_rendered":"<p>楼主小白一枚，是一定会在武汉上车的，时间早晚问题（ 5 年内）。</p>\n<p>工作地点在光谷，但光谷房价太高，估计可能会在白沙洲等地上车或者二手房。</p>\n<p>目前只知道在 安居客，幸福里 等平台查看房价，加中介询问，未实地考察过，也不知从何处考察起。</p>\n<p>没接触过金融地产等相关行业，不太看得懂房价走势，目前在 V 站、知乎、油管等地方获取知识。</p>\n<p>所以在此询问下大伙有关建议，关于看房买房，房价走势，二手房等问题的相关建议都可。</p>\n<p>另外如果有武汉购房群求加入。</p>\n<p>附带上在 V 站看到的比较高赞（ 50+）的相关评论：</p>\n<ul>\n<li>那些说什么刚需上车就完事的就是扯淡，身边刚有人前几个月上车的 2.2 ，现在开发商直接卖 1.8 还能送车位，你就算刚需你说等几个月入手立减几十万你不在乎？他们已经去砸售楼部跟保安群殴去了</li>\n<li>对于只有一套房的人来说涨了是拿不到的纸面数字，跌了是可以拿到的真金白银</li>\n</ul>\n<p>感谢各位的慷慨帮助！</p>\n","last_modified":1644626558,"replies":14,"id":833345},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c74d/97b0/16_large.png?m=1628872984","name":"share","avatar_normal":"https://cdn.v2ex.com/navatar/c74d/97b0/16_normal.png?m=1628872984","title":"分享发现","url":"https://www.v2ex.com/go/share","topics":35015,"footer":"","header":"分享你看到的好玩的，有信息量的，欢迎从这里获取灵感。","title_alternative":"Share","avatar_mini":"https://cdn.v2ex.com/navatar/c74d/97b0/16_mini.png?m=1628872984","stars":4730,"aliases":[],"root":false,"id":16,"parent_node_name":"v2ex"},"member":{"id":251364,"username":"LittleState","url":"https://www.v2ex.com/u/LittleState","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/31e3/3f78/251364_mini.png?m=1566171099","avatar_normal":"https://cdn.v2ex.com/avatar/31e3/3f78/251364_normal.png?m=1566171099","avatar_large":"https://cdn.v2ex.com/avatar/31e3/3f78/251364_large.png?m=1566171099","created":1503985036,"last_modified":1566171099},"last_reply_by":"taogen","last_touched":1644575125,"title":"头一回感觉被拼多多恶心到…","url":"https://www.v2ex.com/t/833350","created":1644629391,"deleted":0,"content":"想上去买个垃圾袋，结果之前的订单提示我可是返现。\n\n我点开看了下让我实名认证，我就赶紧退出了，但是外面有个界面又给了我 1 元，微信到账了。\n\n我就想着那个实名认证应该也是会给的吧，反正也都认证那么多平台了，就弄一下。\n\n\n\n实名认证、绑定银行卡，一顿操作下来给我开通了多多钱包，然后 52 块钱就是给我了…总计 52 元的小额优惠卷……\n\n\n\n注销还要先注销多多钱包，还必须开通时间大于 7 天，真的有被恶心到。我淦！！主要是这顿操作下来给我开通多多钱包、还开通免密支付，结果最后就给我一两元的优惠卷，这特么不是恶心人么，和骗子有区别么…\n\n还有我一路上操作也没看到提示我给我开通免密支付，是看到工行短信提示才发现\n\n\n\n淦！！七天后就注销了这恶心东西","content_rendered":"想上去买个垃圾袋，结果之前的订单提示我可是返现。<br /><br />我点开看了下让我实名认证，我就赶紧退出了，但是外面有个界面又给了我 1 元，微信到账了。<br /><br />我就想着那个实名认证应该也是会给的吧，反正也都认证那么多平台了，就弄一下。<br /><br /><br /><br />实名认证、绑定银行卡，一顿操作下来给我开通了多多钱包，然后 52 块钱就是给我了…总计 52 元的小额优惠卷……<br /><br /><br /><br />注销还要先注销多多钱包，还必须开通时间大于 7 天，真的有被恶心到。我淦！！主要是这顿操作下来给我开通多多钱包、还开通免密支付，结果最后就给我一两元的优惠卷，这特么不是恶心人么，和骗子有区别么…<br /><br />还有我一路上操作也没看到提示我给我开通免密支付，是看到工行短信提示才发现<br /><br /><br /><br />淦！！七天后就注销了这恶心东西","last_modified":1644629391,"replies":13,"id":833350},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/a3c6/5c29/108_large.png?m=1635654723","name":"bb","avatar_normal":"https://cdn.v2ex.com/navatar/a3c6/5c29/108_normal.png?m=1635654723","title":"宽带症候群","url":"https://www.v2ex.com/go/bb","topics":10324,"footer":"","header":"网速很重要。比快更快。","title_alternative":"Broadband Symptom Complex","avatar_mini":"https://cdn.v2ex.com/navatar/a3c6/5c29/108_mini.png?m=1635654723","stars":5381,"aliases":[],"root":false,"id":108,"parent_node_name":"geek"},"member":{"id":274962,"username":"uhoo","url":"https://www.v2ex.com/u/uhoo","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/5cd9081fc1ac57c300dd68a06d6d5067?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/5cd9081fc1ac57c300dd68a06d6d5067?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/5cd9081fc1ac57c300dd68a06d6d5067?s=73&d=retro","created":1513422541,"last_modified":1513422541},"last_reply_by":"uhoo","last_touched":1644638657,"title":"n1 单臂路由 无法访问 ipv4 网络","url":"https://www.v2ex.com/t/833342","created":1644624225,"deleted":0,"content":"之前请教各位推荐路由的，于是入了一个 n1 组单臂路由\n\n猫 桥接 后台 192.168.1.1\n\nn1 后台 192.168.1.2\n\nAP 后台 192.168.1.3\n\n现在只能用 ipv6 上网，请问 n1 的 lan 是不是要配置下 dns 和网关，目前都是留空的，不太懂，网上的教程都没有提到这部分，请各位赐教","content_rendered":"之前请教各位推荐路由的，于是入了一个 n1 组单臂路由<br /><br />猫 桥接 后台 192.168.1.1<br /><br />n1 后台 192.168.1.2<br /><br />AP 后台 192.168.1.3<br /><br />现在只能用 ipv6 上网，请问 n1 的 lan 是不是要配置下 dns 和网关，目前都是留空的，不太懂，网上的教程都没有提到这部分，请各位赐教","last_modified":1644624225,"replies":10,"id":833342},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/70ef/df2e/17_large.png?m=1629391403","name":"create","avatar_normal":"https://cdn.v2ex.com/navatar/70ef/df2e/17_normal.png?m=1629391403","title":"分享创造","url":"https://www.v2ex.com/go/create","topics":17305,"footer":"","header":"欢迎你在这里发布自己的最新作品！","title_alternative":"Create","avatar_mini":"https://cdn.v2ex.com/navatar/70ef/df2e/17_mini.png?m=1629391403","stars":4181,"aliases":[],"root":false,"id":17,"parent_node_name":"geek"},"member":{"id":73472,"username":"willin","url":"https://www.v2ex.com/u/willin","website":"https://willin.wang","twitter":"willinwang","psn":"","github":"willin","btc":"","location":"Nanjing, China","tagline":"To be Willin is to be willing.","bio":"永远不要让自己的生活，有规律无意义地循环。","avatar_mini":"https://cdn.v2ex.com/avatar/b4f9/4067/73472_mini.png?m=1644639799","avatar_normal":"https://cdn.v2ex.com/avatar/b4f9/4067/73472_normal.png?m=1644639799","avatar_large":"https://cdn.v2ex.com/avatar/b4f9/4067/73472_large.png?m=1644639799","created":1410334600,"last_modified":1644639799},"last_reply_by":"hnbcinfo","last_touched":1644642583,"title":"今年的情人节，给心爱的她一个不一样的礼物吧","url":"https://www.v2ex.com/t/833368","created":1644639689,"deleted":0,"content":"给大家隆重介绍一个网站，[憨憨.我爱你]( https://xn--wkua.xn--6qq986b3xl/)\r\n\r\n参考示例网站：\r\n\r\n- [表白幻灯片.憨憨.我爱你]( https://xn--owtp31bqkbezhj50a.xn--wkua.xn--6qq986b3xl/)\r\n  - [源码]( https://github.com/willin-love/romantic_page)\r\n- [恋爱计时器.憨憨.我爱你]( https://xn--m7rx3unue2vok44a.xn--wkua.xn--6qq986b3xl/)\r\n  - [源码]( https://github.com/willin-love/romantic_page)\r\n\r\n\r\n---\r\n\r\n\r\n# 申请流程\r\n\r\n打开官网首页： [憨憨.我爱你]( https://xn--wkua.xn--6qq986b3xl/)\r\n\r\n（由于该网站数据库使用的是 PlanetScale 免费服务，位于美东，所以访问可能会稍微有点慢。请耐心等待。）\r\n\r\n![请添加图片描述]( https://img-blog.csdnimg.cn/f9b3cdea761a4f539f7567270f025add.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16)\r\n\r\n\r\n使用 Authing 账号登录（可以手机、邮箱注册，Github 账号登录，或者微信小程序扫码，后续还会添加更多登录方式）。\r\n\r\n![请添加图片描述]( https://img-blog.csdnimg.cn/ce02809802af45949fe5e4ebf6b5a13f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16)\r\n\r\n\r\n可以分别点击进入域名申请和邮箱申请。\r\n\r\n## 域名申请\r\n\r\n域名申请界面如下：\r\n\r\n![请添加图片描述]( https://img-blog.csdnimg.cn/3a5d3b1d9bee42a187d410aaa17fde9e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16)\r\n\r\n\r\n支持的绑定方式有三种：\r\n\r\n- CNAME： 可以使用 Github Pages 、Netlify 、Gitee 、Coding.net 、Cloudflare 等提供托管服务的平台\r\n  - 值参考： `willin.github.io`\r\n  - 注意： 不支持 Vercel ，因为 Vercel 默认情况下并不支持绑定二级域名（除非所有权在你个人名下）\r\n- A：IPv4 需要自己搭建服务器，并进行绑定\r\n  - 值参考： `1.2.3.4` （你服务器的 ip 地址）\r\n- AAAA: IPv6 需要自己搭建服务器，并进行绑定\r\n  - 不做表述，不太推荐非专业人士选择\r\n  - 如果你需要同时绑定 IPv4 和 IPv6 的话，建议建议注册 A 类型，然后 ISSUE 或邮件联系我配合处理\r\n\r\n其中还有一项 Proxied （ CDN ），如果不知道作用，可以尝试开启或关闭来测试。\r\n\r\n## 邮箱申请\r\n\r\n域名申请界面如下：\r\n\r\n![请添加图片描述]( https://img-blog.csdnimg.cn/8afe37a994924ca4827db00dd3f5b726.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16)\r\n\r\n\r\n目前使用了 Cloudflare 的邮件转发服务，但由于暂不支持 IDN 域名，所以可以提前抢注，第一时间拥有。\r\n\r\n## 其他说明\r\n\r\n### 如需帮助\r\n\r\n欢迎在 Github 上关注我： [willin]( https://github.com/willin) ，如果在为心爱的她准备礼物时遇到问题，可以为你免费提供技术咨询。\r\n\r\n### 还想要其他的域名\r\n\r\n- [js.cool]( https://github.com/js-cool) （在多次协商后，目前已经支持 Vercel 绑定）\r\n- log.lu （敬请期待）\r\n\r\n### 感觉慷慨\r\n\r\n- 您可以将该网站分享给更多的人\r\n- 您也可以通过以下渠道进行打赏：\r\n  - [微信]( https://willin.github.io/images/wx.png)\r\n  - [支付宝]( https://willin.github.io/images/alipay.png)\r\n  - [爱发电]( https://afdian.net/@willin)\r\n  - [Github Sponsors]( https://github.com/sponsors/willin)\r\n  - [Paypal]( https://www.paypal.com/paypalme/willinwang)\r\n\r\n### 跃跃欲试\r\n\r\n或许你也有很多想法，想要实现。您可以：\r\n\r\n- 使用 [Authing]( https://www.authing.cn/?utm_source=v0&utm_campaign=hanhan) 快速集成开发你自己的应用\r\n- Fork 本项目源码（完全开源），并提供你自己的域名服务\r\n  - [项目源码]( https://github.com/willin/xn--wkua.xn--6qq986b3xL)\r\n- 在 Github 上对本项目进行完善和优化\r\n  - [项目后续规划]( https://github.com/willin/xn--wkua.xn--6qq986b3xL/issues/3)\r\n\r\n---\r\n\r\n# 开源\r\n\r\n接下来，开始一个重要的环节。俗话说，授人以鱼不如授人以渔。我将 [憨憨.我爱你 的源码]( https://github.com/willin/xn--wkua.xn--6qq986b3xL) 进行开源，并详细讲解一下设计与实现的全部过程。\r\n\r\n## 设计\r\n\r\n这个项目大概花了我 3 个小时左右完成。为了扬长避短，我使用了 UI 框架，所以就没有额外的 UI 设计了，直接用几个基础组件快速上手该项目。\r\n\r\n### 技术选型\r\n\r\n首先，第一步是技术选型。因为我要提供的是一项免费的服务，所以尽量也选择一些免费的服务商，及一些相关的技术栈。\r\n\r\n服务商的选择：\r\n\r\n- [Cloudflare]( https://www.cloudflare.com/)： 提供免费的域名解析、CDN 加速以及开放的接口\r\n- [Vercel]( https://vercel.com/)： 面向个人的免费应用托管，支持 Node.js 环境，使用 Next.js 框架\r\n- [PlanetScale]( https://planetscale.com)： 具有一定免费额度的云端 MySQL 服务\r\n- [Prisma]( https://www.prisma.io/)：Cloud Studio 管理数据库\r\n\r\n其实，本来是想使用 Cloudflare 全家桶的，就是用 [Cloudflare Pages]( https://pages.cloudflare.com/) （静态网站） + [Cloudflare Workers]( https://workers.cloudflare.com/) （ Serverless 方法执行）及 [KV]( https://developers.cloudflare.com/workers/learning/how-kv-works) （键值对存储），但是由于时间和精力的限制，所以就采用了更简单快捷的实现方式。\r\n\r\n技术栈：\r\n\r\n- [Typescript]( https://www.typescriptlang.org/)： 虽然我喜欢用更少的代码做更多的事情，但 TS 带给我更高效的团队协作舞台\r\n- [Next.js]( https://nextjs.org/)： 一个全栈框架（前端使用 React ，后端类似于 http 模块和 Express ），支持 SSR （服务器端渲染）和 SSG （静态站点生成）\r\n  - [@authing/nextjs]( https://github.com/Authing/authing-nextjs)：Authing SSO 集成 SDK\r\n- [Prisma]( https://www.prisma.io/)： 下一代的 ORM 框架，支持多种数据库（本项目使用为 MySQL ）和数据库迁移（ Migration ）\r\n- [Tailwind CSS]( https://tailwindcss.com/)： 下一代的 CSS 框架，实用第一\r\n  - [Daisy UI]( https://daisyui.com/)：封装了一些 UI 样式组件\r\n\r\n### 数据库设计\r\n\r\n由于我用的是 Authing 用户集成，所以省去了用户表的设计和用户相关接口的设计。\r\n\r\n```prisma\r\n// 域名类型\r\nenum DomainType {\r\n  A\r\n  AAAA\r\n  CNAME\r\n}\r\n\r\n// 审核状态\r\nenum Status {\r\n  // 待审核\r\n  PENDING\r\n  // 激活\r\n  ACTIVE\r\n  // 已删除\r\n  DELETED\r\n  // 被管理员禁用\r\n  BANNED\r\n}\r\n\r\n// 域名记录表\r\nmodel Domains {\r\n  // Cloudflare 域名记录的 ID ，同时作为表主键 id\r\n  id        String      @id @default(cuid()) @db.VarChar(32)\r\n  // 自增 id ，没有什么实际意义，只是为了减少查询（毕竟有调用配额限制），实际项目中不推荐自增主键及自增 id 使用\r\n  no        Int         @default(autoincrement()) @db.UnsignedInt\r\n  name      String      @db.VarChar(255)\r\n  punycode  String      @db.VarChar(255)\r\n  type      DomainType  @default(CNAME)\r\n  content   String      @default(\"\") @db.VarChar(255)\r\n  proxied   Boolean     @default(true)\r\n  // Authing 的用户 id\r\n  user      String      @default(\"\") @db.VarChar(32)\r\n  status    Status      @default(ACTIVE)\r\n  createdAt DateTime    @default(now())\r\n  updatedAt DateTime    @updatedAt\r\n\r\n  @@index([no])\r\n  @@index([name, punycode])\r\n  @@index([user, status, createdAt])\r\n}\r\n\r\n// 邮箱表\r\nmodel Emails {\r\n  // 由于 Cloudflare 邮箱还没有提供开放接口，所以需要人工审核和操作，这里会填入默认的 cuid 作为主键 id\r\n  id        String      @id @default(cuid()) @db.VarChar(32)\r\n  // 自增 id ，没有什么实际意义，只是为了减少查询（毕竟有调用配额限制），实际项目中不推荐自增主键及自增 id 使用\r\n  no        Int         @default(autoincrement()) @db.UnsignedInt\r\n  name      String      @db.VarChar(255)\r\n  punycode  String      @db.VarChar(255)\r\n  content   String      @default(\"\") @db.VarChar(255)\r\n  user      String      @default(\"\") @db.VarChar(32)\r\n  status    Status      @default(PENDING)\r\n  createdAt DateTime    @default(now())\r\n  updatedAt DateTime    @updatedAt\r\n\r\n  @@index([no])\r\n  @@index([name, punycode])\r\n  @@index([user, status, createdAt])\r\n}\r\n```\r\n\r\n非常简单，参考注释说明。另外，我本来是打算只存一个名称的，但由于会重复注册，比如说我注册了一个中文名`老王`，你又注册了一个对应的 punycode 代码名 `xn--qbyt9x`，就会冲突，所以索性（偷懒）都存下吧。\r\n\r\n### 技术准备\r\n\r\n- 中文域名需要掌握的 Punycode 知识： [RFC 3492]( https://www.rfc-editor.org/rfc/inline-errata/rfc3492.html) 规范\r\n- Cloudflare [API 接口]( https://developers.cloudflare.com/api/)\r\n  - 创建一条解析： [Create DNS Record]( https://api.cloudflare.com/#dns-records-for-a-zone-create-dns-record)\r\n  - 修改一条解析： [Patch DNS Record]( https://api.cloudflare.com/#dns-records-for-a-zone-patch-dns-record)\r\n  - 删除一条解析： [Delete DNS Record]( https://api.cloudflare.com/#dns-records-for-a-zone-delete-dns-record)\r\n- Authing SSO 集成，可以参考我之前的文章： [《全栈框架应用快速集成 Authing SSO 》]( https://willin.wang/posts/authing-full-stack)\r\n\r\n先把 Next.js 网站框架搭建起来，部署到 Vercel 上进行测试。可以再加上 Tailwind CSS 和 Authing SSO 集成。第一步准备工作就算完成了。\r\n\r\n### 接口设计\r\n\r\n为了快速（偷懒）实现，我分别创建了增删改查四个接口。\r\n\r\n查询接口：\r\n\r\n```mermaid\r\ngraph TD\r\n    Start1(Start)\r\n    --> |检查域名是否存在| check1{是否登录}\r\n    --> |F| fail1[失败]\r\n    --> End1(End)\r\n    check1 --> |T| check12{检查是否为保留域名}\r\n    --> |T| fail1\r\n    check12 --> |F| check13{检查数据库重复}\r\n    --> |T| fail1\r\n    check13 --> |F| success1[允许注册]\r\n    --> End1\r\n```\r\n\r\n创建接口：\r\n\r\n```mermaid\r\ngraph TD\r\n    Start2(Start)\r\n    --> |创建域名| check2{是否登录}\r\n    --> |F| fail2[失败]\r\n    --> End2(End)\r\n    check2 --> |T| check22{检查是否为保留域名}\r\n    --> |T| fail2\r\n    check22 --> |F| check23{用户是否已经注册域名}\r\n    --> |T| fail2\r\n    check23 --> |F| check24{检查数据库重复}\r\n    --> |T| fail2\r\n    check24 --> |F| success2[注册]\r\n    --> End2\r\n```\r\n\r\n数据库查询用户是否已经注册域名和是否存在同名可以用一次查询完成，这里为了提高查询性能进行了拆分。\r\n\r\n修改接口：\r\n\r\n```mermaid\r\ngraph TD\r\n    Start3(Start)\r\n    --> |检查域名是否存在| check3{是否登录}\r\n    --> |F| fail3[失败]\r\n    --> End3(End)\r\n    check3 --> |T| check32{修改 id 和 用户匹配的记录}\r\n    --> |F 修改记录数 0| fail3\r\n    check32 --> |T| success3[修改成功]\r\n    --> End3\r\n```\r\n\r\n删除接口与修改接口同。邮箱接口与域名类似，不再赘述。\r\n\r\n## 代码实现\r\n\r\n### 封装 Cloudflare SDK\r\n\r\n当然也有现成的库可以直接用，但是因为没几行代码，我就自己手撸了。\r\n\r\n```ts\r\nimport { Domains } from '@prisma/client';\r\nimport { CfAPIToken, CfZoneId } from '../config';\r\n\r\nconst BASE_URL = 'https://api.cloudflare.com/client/v4';\r\n\r\nexport type CFResult = {\r\n  success: boolean;\r\n  result: {\r\n    id: string;\r\n  };\r\n};\r\n\r\nconst headers = {\r\n  Authorization: `Bearer ${CfAPIToken}`,\r\n  'Content-Type': 'application/json'\r\n};\r\n\r\nexport const createDomain = async (\r\n  form: Pick<Domains, 'name' | 'content' | 'type' | 'proxied'>\r\n): Promise<string> => {\r\n  const res = await fetch(`${BASE_URL}/zones/${CfZoneId}/dns_records`, {\r\n    method: 'POST',\r\n    headers,\r\n    body: JSON.stringify({ ...form, ttl: 1 })\r\n  });\r\n  const data = (await res.json()) as CFResult;\r\n  if (data.success) {\r\n    return data.result.id;\r\n  }\r\n  return '';\r\n};\r\n\r\nexport const updateDomain = async (\r\n  id: string,\r\n  form: Pick<Domains, 'name' | 'content' | 'type' | 'proxied'>\r\n): Promise<boolean> => {\r\n  const res = await fetch(`${BASE_URL}/zones/${CfZoneId}/dns_records/${id}`, {\r\n    method: 'PATCH',\r\n    headers,\r\n    body: JSON.stringify({ ...form, ttl: 1 })\r\n  });\r\n  const data = (await res.json()) as CFResult;\r\n  console.error(data);\r\n  return data.success;\r\n};\r\n\r\nexport const deleteDomain = async (id: string): Promise<boolean> => {\r\n  const res = await fetch(`${BASE_URL}/zones/${CfZoneId}/dns_records/${id}`, {\r\n    method: 'DELETE',\r\n    headers\r\n  });\r\n  const data = (await res.json()) as CFResult;\r\n  return !!data.result.id;\r\n};\r\n```\r\n\r\n### 封装校验工具类\r\n\r\n需要有一定的正则基础，如果你需要在线调试工具，可以访问： [regexper.js.cool]( https://regexper.js.cool/)\r\n\r\n域名（ CNAME ）校验正则：\r\n\r\n```js\r\n/^((?!-))(xn--)?[a-z0-9][a-z0-9-_]{0,61}[a-z0-9]{0,1}\\.(xn--)?([a-z0-9-]{1,61}|[a-z0-9-]{1,30}\\.[a-z]{2,})$/;\r\n```\r\n\r\n邮箱校验正则：\r\n\r\n```js\r\n/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/;\r\n```\r\n\r\nIPv4 校验正则：\r\n\r\n```js\r\n/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\r\n```\r\n\r\nIPv6 校验正则：\r\n\r\n```js\r\n/^((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:)))(%.+)?$/;\r\n```\r\n\r\n### 页面请求封装\r\n\r\n以域名注册提交为例：\r\n\r\n```ts\r\nasync function submit(e: SyntheticEvent) {\r\n  e.preventDefault();\r\n  // 因为我 Vue 、React 都会用，且用的都比较少\r\n  // 所以获取表单数据，我用的是 Vanilla JS 方式，通用性更高\r\n  // 如果你不熟悉，可以用 React 的方式\r\n  const target = e.currentTarget as typeof e.currentTarget & {\r\n    type: { value: DomainType };\r\n    content: { value: string };\r\n    proxied: { checked: boolean };\r\n  };\r\n  const type = target.type.value;\r\n  const content = target.content.value;\r\n  if (!validateContent(type, content)) {\r\n    return;\r\n  }\r\n  const form = {\r\n    type,\r\n    content,\r\n    proxied: target.proxied.checked,\r\n    name,\r\n    punycode: toASCII(name)\r\n  };\r\n  // 我建议对 Fetch 进行封装，为了追求效率（偷懒），我就没有做\r\n  const res = await fetch(`/api/domain/create`, {\r\n    method: 'POST',\r\n    body: JSON.stringify(form),\r\n    headers: {\r\n      'content-type': 'application/json'\r\n    }\r\n  });\r\n  // 所以像这样的处理，就非常不优雅，而且还可以统一封装，将错误提示使用通知条组件之类的\r\n  const result = (await res.json()) as { success: boolean; id: string };\r\n  if (result.success) {\r\n    router.reload();\r\n  } else {\r\n    alert('出错啦！请稍后重试');\r\n  }\r\n}\r\n```\r\n\r\n可复用的代码可以进行封装。参考软件工程的思想：高内聚、低耦合。我这里举的是一个较为反面的教材，代码臃肿、可读性低。\r\n\r\n### 注意点\r\n\r\n- 由于 Tailwind CSS 3 采用了全新的 JIT 机制，purgecss 不再需要\r\n- 关注 React 性能，如 `useState` 之类的 Hooks ，尽量放在页面级别，不要放在组件级别（尤其是会循环生成的组件）\r\n- 使用 `useMemo` 、 `debounce` 之类的方式进行缓存、防抖、限流，以提升应用性能\r\n- 使用 Next.js 框架（或普通 React 应用）时，大部分情况下，多了解 `swr` 及其内部的一些核心思想会很有裨益\r\n\r\n剩下的代码部分就枯燥且简单了。\r\n\r\n---\r\n\r\n差不多就讲这么多吧。记得分享哦！\r\n\r\n[willin]( https://github.com/willin) | [憨憨.我爱你]( https://xn--wkua.xn--6qq986b3xl/) | [项目源码]( https://github.com/willin/xn--wkua.xn--6qq986b3xL)","content_rendered":"<p>给大家隆重介绍一个网站，<a href=\"https://xn--wkua.xn--6qq986b3xl/\" rel=\"nofollow\">憨憨.我爱你</a></p>\n<p>参考示例网站：</p>\n<ul>\n<li>\n<a href=\"https://xn--owtp31bqkbezhj50a.xn--wkua.xn--6qq986b3xl/\" rel=\"nofollow\">表白幻灯片.憨憨.我爱你</a><ul>\n<li><a href=\"https://github.com/willin-love/romantic_page\" rel=\"nofollow\">源码</a></li>\n</ul>\n</li>\n<li>\n<a href=\"https://xn--m7rx3unue2vok44a.xn--wkua.xn--6qq986b3xl/\" rel=\"nofollow\">恋爱计时器.憨憨.我爱你</a><ul>\n<li><a href=\"https://github.com/willin-love/romantic_page\" rel=\"nofollow\">源码</a></li>\n</ul>\n</li>\n</ul>\n<hr/>\n<h1>申请流程</h1>\n<p>打开官网首页： <a href=\"https://xn--wkua.xn--6qq986b3xl/\" rel=\"nofollow\">憨憨.我爱你</a></p>\n<p>（由于该网站数据库使用的是 PlanetScale 免费服务，位于美东，所以访问可能会稍微有点慢。请耐心等待。）</p>\n<p><img alt=\"请添加图片描述\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://img-blog.csdnimg.cn/f9b3cdea761a4f539f7567270f025add.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16\"/></p>\n<p>使用 Authing 账号登录（可以手机、邮箱注册，Github 账号登录，或者微信小程序扫码，后续还会添加更多登录方式）。</p>\n<p><img alt=\"请添加图片描述\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://img-blog.csdnimg.cn/ce02809802af45949fe5e4ebf6b5a13f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16\"/></p>\n<p>可以分别点击进入域名申请和邮箱申请。</p>\n<h2>域名申请</h2>\n<p>域名申请界面如下：</p>\n<p><img alt=\"请添加图片描述\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://img-blog.csdnimg.cn/3a5d3b1d9bee42a187d410aaa17fde9e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16\"/></p>\n<p>支持的绑定方式有三种：</p>\n<ul>\n<li>\nCNAME： 可以使用 Github Pages 、Netlify 、Gitee 、<a href=\"http://Coding.net\" rel=\"nofollow\">Coding.net</a> 、Cloudflare 等提供托管服务的平台<ul>\n<li>值参考： <code><a href=\"http://willin.github.io\" rel=\"nofollow\">willin.github.io</a></code></li>\n<li>注意： 不支持 Vercel ，因为 Vercel 默认情况下并不支持绑定二级域名（除非所有权在你个人名下）</li>\n</ul>\n</li>\n<li>\nA：IPv4 需要自己搭建服务器，并进行绑定<ul>\n<li>值参考： <code>1.2.3.4</code> （你服务器的 ip 地址）</li>\n</ul>\n</li>\n<li>\nAAAA: IPv6 需要自己搭建服务器，并进行绑定<ul>\n<li>不做表述，不太推荐非专业人士选择</li>\n<li>如果你需要同时绑定 IPv4 和 IPv6 的话，建议建议注册 A 类型，然后 ISSUE 或邮件联系我配合处理</li>\n</ul>\n</li>\n</ul>\n<p>其中还有一项 Proxied （ CDN ），如果不知道作用，可以尝试开启或关闭来测试。</p>\n<h2>邮箱申请</h2>\n<p>域名申请界面如下：</p>\n<p><img alt=\"请添加图片描述\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://img-blog.csdnimg.cn/8afe37a994924ca4827db00dd3f5b726.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAV2lsbGluIFdhbmc=,size_20,color_FFFFFF,t_70,g_se,x_16\"/></p>\n<p>目前使用了 Cloudflare 的邮件转发服务，但由于暂不支持 IDN 域名，所以可以提前抢注，第一时间拥有。</p>\n<h2>其他说明</h2>\n<h3>如需帮助</h3>\n<p>欢迎在 Github 上关注我： <a href=\"https://github.com/willin\" rel=\"nofollow\">willin</a> ，如果在为心爱的她准备礼物时遇到问题，可以为你免费提供技术咨询。</p>\n<h3>还想要其他的域名</h3>\n<ul>\n<li><a href=\"https://github.com/js-cool\" rel=\"nofollow\">js.cool</a> （在多次协商后，目前已经支持 Vercel 绑定）</li>\n<li><a href=\"http://log.lu\" rel=\"nofollow\">log.lu</a> （敬请期待）</li>\n</ul>\n<h3>感觉慷慨</h3>\n<ul>\n<li>您可以将该网站分享给更多的人</li>\n<li>\n您也可以通过以下渠道进行打赏：<ul>\n<li><a href=\"https://willin.github.io/images/wx.png\" rel=\"nofollow\">微信</a></li>\n<li><a href=\"https://willin.github.io/images/alipay.png\" rel=\"nofollow\">支付宝</a></li>\n<li><a href=\"https://afdian.net/@willin\" rel=\"nofollow\">爱发电</a></li>\n<li><a href=\"https://github.com/sponsors/willin\" rel=\"nofollow\">Github Sponsors</a></li>\n<li><a href=\"https://www.paypal.com/paypalme/willinwang\" rel=\"nofollow\">Paypal</a></li>\n</ul>\n</li>\n</ul>\n<h3>跃跃欲试</h3>\n<p>或许你也有很多想法，想要实现。您可以：</p>\n<ul>\n<li>使用 <a href=\"https://www.authing.cn/?utm_source=v0&amp;utm_campaign=hanhan\" rel=\"nofollow\">Authing</a> 快速集成开发你自己的应用</li>\n<li>\nFork 本项目源码（完全开源），并提供你自己的域名服务<ul>\n<li><a href=\"https://github.com/willin/xn--wkua.xn--6qq986b3xL\" rel=\"nofollow\">项目源码</a></li>\n</ul>\n</li>\n<li>\n在 Github 上对本项目进行完善和优化<ul>\n<li><a href=\"https://github.com/willin/xn--wkua.xn--6qq986b3xL/issues/3\" rel=\"nofollow\">项目后续规划</a></li>\n</ul>\n</li>\n</ul>\n<hr/>\n<h1>开源</h1>\n<p>接下来，开始一个重要的环节。俗话说，授人以鱼不如授人以渔。我将 <a href=\"https://github.com/willin/xn--wkua.xn--6qq986b3xL\" rel=\"nofollow\">憨憨.我爱你 的源码</a> 进行开源，并详细讲解一下设计与实现的全部过程。</p>\n<h2>设计</h2>\n<p>这个项目大概花了我 3 个小时左右完成。为了扬长避短，我使用了 UI 框架，所以就没有额外的 UI 设计了，直接用几个基础组件快速上手该项目。</p>\n<h3>技术选型</h3>\n<p>首先，第一步是技术选型。因为我要提供的是一项免费的服务，所以尽量也选择一些免费的服务商，及一些相关的技术栈。</p>\n<p>服务商的选择：</p>\n<ul>\n<li><a href=\"https://www.cloudflare.com/\" rel=\"nofollow\">Cloudflare</a>： 提供免费的域名解析、CDN 加速以及开放的接口</li>\n<li><a href=\"https://vercel.com/\" rel=\"nofollow\">Vercel</a>： 面向个人的免费应用托管，支持 Node.js 环境，使用 Next.js 框架</li>\n<li><a href=\"https://planetscale.com\" rel=\"nofollow\">PlanetScale</a>： 具有一定免费额度的云端 MySQL 服务</li>\n<li><a href=\"https://www.prisma.io/\" rel=\"nofollow\">Prisma</a>：Cloud Studio 管理数据库</li>\n</ul>\n<p>其实，本来是想使用 Cloudflare 全家桶的，就是用 <a href=\"https://pages.cloudflare.com/\" rel=\"nofollow\">Cloudflare Pages</a> （静态网站） + <a href=\"https://workers.cloudflare.com/\" rel=\"nofollow\">Cloudflare Workers</a> （ Serverless 方法执行）及 <a href=\"https://developers.cloudflare.com/workers/learning/how-kv-works\" rel=\"nofollow\">KV</a> （键值对存储），但是由于时间和精力的限制，所以就采用了更简单快捷的实现方式。</p>\n<p>技术栈：</p>\n<ul>\n<li><a href=\"https://www.typescriptlang.org/\" rel=\"nofollow\">Typescript</a>： 虽然我喜欢用更少的代码做更多的事情，但 TS 带给我更高效的团队协作舞台</li>\n<li>\n<a href=\"https://nextjs.org/\" rel=\"nofollow\">Next.js</a>： 一个全栈框架（前端使用 React ，后端类似于 http 模块和 Express ），支持 SSR （服务器端渲染）和 SSG （静态站点生成）<ul>\n<li><a href=\"https://github.com/Authing/authing-nextjs\" rel=\"nofollow\">@authing/nextjs</a>：Authing SSO 集成 SDK</li>\n</ul>\n</li>\n<li><a href=\"https://www.prisma.io/\" rel=\"nofollow\">Prisma</a>： 下一代的 ORM 框架，支持多种数据库（本项目使用为 MySQL ）和数据库迁移（ Migration ）</li>\n<li>\n<a href=\"https://tailwindcss.com/\" rel=\"nofollow\">Tailwind CSS</a>： 下一代的 CSS 框架，实用第一<ul>\n<li><a href=\"https://daisyui.com/\" rel=\"nofollow\">Daisy UI</a>：封装了一些 UI 样式组件</li>\n</ul>\n</li>\n</ul>\n<h3>数据库设计</h3>\n<p>由于我用的是 Authing 用户集成，所以省去了用户表的设计和用户相关接口的设计。</p>\n<pre><code class=\"language-prisma\">// 域名类型\nenum DomainType {\n  A\n  AAAA\n  CNAME\n}\n\n// 审核状态\nenum Status {\n  // 待审核\n  PENDING\n  // 激活\n  ACTIVE\n  // 已删除\n  DELETED\n  // 被管理员禁用\n  BANNED\n}\n\n// 域名记录表\nmodel Domains {\n  // Cloudflare 域名记录的 ID ，同时作为表主键 id\n  id        String      @id @default(cuid()) @db.VarChar(32)\n  // 自增 id ，没有什么实际意义，只是为了减少查询（毕竟有调用配额限制），实际项目中不推荐自增主键及自增 id 使用\n  no        Int         @default(autoincrement()) @db.UnsignedInt\n  name      String      @db.VarChar(255)\n  punycode  String      @db.VarChar(255)\n  type      DomainType  @default(CNAME)\n  content   String      @default(\"\") @db.VarChar(255)\n  proxied   Boolean     @default(true)\n  // Authing 的用户 id\n  user      String      @default(\"\") @db.VarChar(32)\n  status    Status      @default(ACTIVE)\n  createdAt DateTime    @default(now())\n  updatedAt DateTime    @updatedAt\n\n  @@index([no])\n  @@index([name, punycode])\n  @@index([user, status, createdAt])\n}\n\n// 邮箱表\nmodel Emails {\n  // 由于 Cloudflare 邮箱还没有提供开放接口，所以需要人工审核和操作，这里会填入默认的 cuid 作为主键 id\n  id        String      @id @default(cuid()) @db.VarChar(32)\n  // 自增 id ，没有什么实际意义，只是为了减少查询（毕竟有调用配额限制），实际项目中不推荐自增主键及自增 id 使用\n  no        Int         @default(autoincrement()) @db.UnsignedInt\n  name      String      @db.VarChar(255)\n  punycode  String      @db.VarChar(255)\n  content   String      @default(\"\") @db.VarChar(255)\n  user      String      @default(\"\") @db.VarChar(32)\n  status    Status      @default(PENDING)\n  createdAt DateTime    @default(now())\n  updatedAt DateTime    @updatedAt\n\n  @@index([no])\n  @@index([name, punycode])\n  @@index([user, status, createdAt])\n}\n</code></pre>\n<p>非常简单，参考注释说明。另外，我本来是打算只存一个名称的，但由于会重复注册，比如说我注册了一个中文名<code>老王</code>，你又注册了一个对应的 punycode 代码名 <code>xn--qbyt9x</code>，就会冲突，所以索性（偷懒）都存下吧。</p>\n<h3>技术准备</h3>\n<ul>\n<li>中文域名需要掌握的 Punycode 知识： <a href=\"https://www.rfc-editor.org/rfc/inline-errata/rfc3492.html\" rel=\"nofollow\">RFC 3492</a> 规范</li>\n<li>\nCloudflare <a href=\"https://developers.cloudflare.com/api/\" rel=\"nofollow\">API 接口</a><ul>\n<li>创建一条解析： <a href=\"https://api.cloudflare.com/#dns-records-for-a-zone-create-dns-record\" rel=\"nofollow\">Create DNS Record</a></li>\n<li>修改一条解析： <a href=\"https://api.cloudflare.com/#dns-records-for-a-zone-patch-dns-record\" rel=\"nofollow\">Patch DNS Record</a></li>\n<li>删除一条解析： <a href=\"https://api.cloudflare.com/#dns-records-for-a-zone-delete-dns-record\" rel=\"nofollow\">Delete DNS Record</a></li>\n</ul>\n</li>\n<li>Authing SSO 集成，可以参考我之前的文章： <a href=\"https://willin.wang/posts/authing-full-stack\" rel=\"nofollow\">《全栈框架应用快速集成 Authing SSO 》</a></li>\n</ul>\n<p>先把 Next.js 网站框架搭建起来，部署到 Vercel 上进行测试。可以再加上 Tailwind CSS 和 Authing SSO 集成。第一步准备工作就算完成了。</p>\n<h3>接口设计</h3>\n<p>为了快速（偷懒）实现，我分别创建了增删改查四个接口。</p>\n<p>查询接口：</p>\n<pre><code class=\"language-mermaid\">graph TD\n    Start1(Start)\n    --&gt; |检查域名是否存在| check1{是否登录}\n    --&gt; |F| fail1[失败]\n    --&gt; End1(End)\n    check1 --&gt; |T| check12{检查是否为保留域名}\n    --&gt; |T| fail1\n    check12 --&gt; |F| check13{检查数据库重复}\n    --&gt; |T| fail1\n    check13 --&gt; |F| success1[允许注册]\n    --&gt; End1\n</code></pre>\n<p>创建接口：</p>\n<pre><code class=\"language-mermaid\">graph TD\n    Start2(Start)\n    --&gt; |创建域名| check2{是否登录}\n    --&gt; |F| fail2[失败]\n    --&gt; End2(End)\n    check2 --&gt; |T| check22{检查是否为保留域名}\n    --&gt; |T| fail2\n    check22 --&gt; |F| check23{用户是否已经注册域名}\n    --&gt; |T| fail2\n    check23 --&gt; |F| check24{检查数据库重复}\n    --&gt; |T| fail2\n    check24 --&gt; |F| success2[注册]\n    --&gt; End2\n</code></pre>\n<p>数据库查询用户是否已经注册域名和是否存在同名可以用一次查询完成，这里为了提高查询性能进行了拆分。</p>\n<p>修改接口：</p>\n<pre><code class=\"language-mermaid\">graph TD\n    Start3(Start)\n    --&gt; |检查域名是否存在| check3{是否登录}\n    --&gt; |F| fail3[失败]\n    --&gt; End3(End)\n    check3 --&gt; |T| check32{修改 id 和 用户匹配的记录}\n    --&gt; |F 修改记录数 0| fail3\n    check32 --&gt; |T| success3[修改成功]\n    --&gt; End3\n</code></pre>\n<p>删除接口与修改接口同。邮箱接口与域名类似，不再赘述。</p>\n<h2>代码实现</h2>\n<h3>封装 Cloudflare SDK</h3>\n<p>当然也有现成的库可以直接用，但是因为没几行代码，我就自己手撸了。</p>\n<pre><code class=\"language-ts\">import { Domains } from '@prisma/client';\nimport { CfAPIToken, CfZoneId } from '../config';\n\nconst BASE_URL = 'https://api.cloudflare.com/client/v4';\n\nexport type CFResult = {\n  success: boolean;\n  result: {\n    id: string;\n  };\n};\n\nconst headers = {\n  Authorization: `Bearer ${CfAPIToken}`,\n  'Content-Type': 'application/json'\n};\n\nexport const createDomain = async (\n  form: Pick&lt;Domains, 'name' | 'content' | 'type' | 'proxied'&gt;\n): Promise&lt;string&gt; =&gt; {\n  const res = await fetch(`${BASE_URL}/zones/${CfZoneId}/dns_records`, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify({ ...form, ttl: 1 })\n  });\n  const data = (await res.json()) as CFResult;\n  if (data.success) {\n    return data.result.id;\n  }\n  return '';\n};\n\nexport const updateDomain = async (\n  id: string,\n  form: Pick&lt;Domains, 'name' | 'content' | 'type' | 'proxied'&gt;\n): Promise&lt;boolean&gt; =&gt; {\n  const res = await fetch(`${BASE_URL}/zones/${CfZoneId}/dns_records/${id}`, {\n    method: 'PATCH',\n    headers,\n    body: JSON.stringify({ ...form, ttl: 1 })\n  });\n  const data = (await res.json()) as CFResult;\n  console.error(data);\n  return data.success;\n};\n\nexport const deleteDomain = async (id: string): Promise&lt;boolean&gt; =&gt; {\n  const res = await fetch(`${BASE_URL}/zones/${CfZoneId}/dns_records/${id}`, {\n    method: 'DELETE',\n    headers\n  });\n  const data = (await res.json()) as CFResult;\n  return !!data.result.id;\n};\n</code></pre>\n<h3>封装校验工具类</h3>\n<p>需要有一定的正则基础，如果你需要在线调试工具，可以访问： <a href=\"https://regexper.js.cool/\" rel=\"nofollow\">regexper.js.cool</a></p>\n<p>域名（ CNAME ）校验正则：</p>\n<pre><code class=\"language-js\">/^((?!-))(xn--)?[a-z0-9][a-z0-9-_]{0,61}[a-z0-9]{0,1}\\.(xn--)?([a-z0-9-]{1,61}|[a-z0-9-]{1,30}\\.[a-z]{2,})$/;\n</code></pre>\n<p>邮箱校验正则：</p>\n<pre><code class=\"language-js\">/^[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/;\n</code></pre>\n<p>IPv4 校验正则：</p>\n<pre><code class=\"language-js\">/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n</code></pre>\n<p>IPv6 校验正则：</p>\n<pre><code class=\"language-js\">/^((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])){3}))|:)))(%.+)?$/;\n</code></pre>\n<h3>页面请求封装</h3>\n<p>以域名注册提交为例：</p>\n<pre><code class=\"language-ts\">async function submit(e: SyntheticEvent) {\n  e.preventDefault();\n  // 因为我 Vue 、React 都会用，且用的都比较少\n  // 所以获取表单数据，我用的是 Vanilla JS 方式，通用性更高\n  // 如果你不熟悉，可以用 React 的方式\n  const target = e.currentTarget as typeof e.currentTarget &amp; {\n    type: { value: DomainType };\n    content: { value: string };\n    proxied: { checked: boolean };\n  };\n  const type = target.type.value;\n  const content = target.content.value;\n  if (!validateContent(type, content)) {\n    return;\n  }\n  const form = {\n    type,\n    content,\n    proxied: target.proxied.checked,\n    name,\n    punycode: toASCII(name)\n  };\n  // 我建议对 Fetch 进行封装，为了追求效率（偷懒），我就没有做\n  const res = await fetch(`/api/domain/create`, {\n    method: 'POST',\n    body: JSON.stringify(form),\n    headers: {\n      'content-type': 'application/json'\n    }\n  });\n  // 所以像这样的处理，就非常不优雅，而且还可以统一封装，将错误提示使用通知条组件之类的\n  const result = (await res.json()) as { success: boolean; id: string };\n  if (result.success) {\n    router.reload();\n  } else {\n    alert('出错啦！请稍后重试');\n  }\n}\n</code></pre>\n<p>可复用的代码可以进行封装。参考软件工程的思想：高内聚、低耦合。我这里举的是一个较为反面的教材，代码臃肿、可读性低。</p>\n<h3>注意点</h3>\n<ul>\n<li>由于 Tailwind CSS 3 采用了全新的 JIT 机制，purgecss 不再需要</li>\n<li>关注 React 性能，如 <code>useState</code> 之类的 Hooks ，尽量放在页面级别，不要放在组件级别（尤其是会循环生成的组件）</li>\n<li>使用 <code>useMemo</code> 、 <code>debounce</code> 之类的方式进行缓存、防抖、限流，以提升应用性能</li>\n<li>使用 Next.js 框架（或普通 React 应用）时，大部分情况下，多了解 <code>swr</code> 及其内部的一些核心思想会很有裨益</li>\n</ul>\n<p>剩下的代码部分就枯燥且简单了。</p>\n<hr/>\n<p>差不多就讲这么多吧。记得分享哦！</p>\n<p><a href=\"https://github.com/willin\" rel=\"nofollow\">willin</a> | <a href=\"https://xn--wkua.xn--6qq986b3xl/\" rel=\"nofollow\">憨憨.我爱你</a> | <a href=\"https://github.com/willin/xn--wkua.xn--6qq986b3xL\" rel=\"nofollow\">项目源码</a></p>\n","last_modified":1644639733,"replies":9,"id":833368},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/a4f2/3670/260_large.png?m=1633245702","name":"security","avatar_normal":"https://cdn.v2ex.com/navatar/a4f2/3670/260_normal.png?m=1633245702","title":"信息安全","url":"https://www.v2ex.com/go/security","topics":1290,"footer":"","header":"我们都希望自己管理的计算机系统在运转过程中不要遇到任何安全事件。只是，这个不完美的世界的现实告诉我们：学无止境。","title_alternative":"Security","avatar_mini":"https://cdn.v2ex.com/navatar/a4f2/3670/260_mini.png?m=1633245702","stars":1425,"aliases":[],"root":false,"id":260,"parent_node_name":"geek"},"member":{"id":544444,"username":"BloodBlade","url":"https://www.v2ex.com/u/BloodBlade","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/gravatar/cbe542f7a03e365f746c7376b4996c81?s=24&d=retro","avatar_normal":"https://cdn.v2ex.com/gravatar/cbe542f7a03e365f746c7376b4996c81?s=48&d=retro","avatar_large":"https://cdn.v2ex.com/gravatar/cbe542f7a03e365f746c7376b4996c81?s=73&d=retro","created":1620117946,"last_modified":1620117946},"last_reply_by":"nvkou","last_touched":1644643463,"title":"请问大家是如何保存账号的恢复代码的？","url":"https://www.v2ex.com/t/833362","created":1644637360,"deleted":0,"content":"原本是保存在密码管理器里面，但是最近想到，如果密码管理器出了问题，那岂不是恢复代码也无法访问了吗？","content_rendered":"<p>原本是保存在密码管理器里面，但是最近想到，如果密码管理器出了问题，那岂不是恢复代码也无法访问了吗？</p>\n","last_modified":1644639586,"replies":8,"id":833362},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/3417/3cb3/30_large.png?m=1598508698","name":"chengdu","avatar_normal":"https://cdn.v2ex.com/navatar/3417/3cb3/30_normal.png?m=1598508698","title":"成都","url":"https://www.v2ex.com/go/chengdu","topics":1179,"footer":"","header":"","title_alternative":"Chengdu","avatar_mini":"https://cdn.v2ex.com/navatar/3417/3cb3/30_mini.png?m=1598508698","stars":975,"aliases":[],"root":false,"id":30,"parent_node_name":"cn"},"member":{"id":546058,"username":"ersansan233","url":"https://www.v2ex.com/u/ersansan233","website":null,"twitter":null,"psn":null,"github":null,"btc":null,"location":null,"tagline":null,"bio":null,"avatar_mini":"https://cdn.v2ex.com/avatar/800a/c142/546058_mini.png?m=1636087979","avatar_normal":"https://cdn.v2ex.com/avatar/800a/c142/546058_normal.png?m=1636087979","avatar_large":"https://cdn.v2ex.com/avatar/800a/c142/546058_large.png?m=1636087979","created":1621735438,"last_modified":1636087979},"last_reply_by":"bug403","last_touched":1644643376,"title":"成都新房摇号太难了","url":"https://www.v2ex.com/t/833355","created":1644632409,"deleted":0,"content":"本人外省户口，只有高新两年社保，新盘摇号太难了","content_rendered":"本人外省户口，只有高新两年社保，新盘摇号太难了","last_modified":1644633319,"replies":8,"id":833355}]